<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://www.sunjianbo.com</id>
    <title>å­™å»ºåšçš„å°ç«™</title>
    <updated>2020-08-17T07:31:13.568Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://www.sunjianbo.com"/>
    <link rel="self" href="https://www.sunjianbo.com/atom.xml"/>
    <subtitle>äº’è”ç½‘ã€ç¼–ç¨‹ã€ç”Ÿæ´»æ„Ÿæ‚Ÿï¼Œåœ¨è¿™é‡Œå¸Œæœ›ä½ æˆ‘éƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼Œå¾—åˆ°æå‡</subtitle>
    <logo>https://www.sunjianbo.com/images/avatar.png</logo>
    <icon>https://www.sunjianbo.com/favicon.ico</icon>
    <rights>All rights reserved 2020, å­™å»ºåšçš„å°ç«™</rights>
    <entry>
        <title type="html"><![CDATA[çº¿ç¨‹æ± åº”ç”¨åŠå®ç°åŸç†å‰–æ]]></title>
        <id>https://www.sunjianbo.com/thread-pool/</id>
        <link href="https://www.sunjianbo.com/thread-pool/">
        </link>
        <updated>2020-08-17T07:30:17.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± ">ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </h2>
<p>çº¿ç¨‹æ˜¯ä¸æ˜¯è¶Šå¤šè¶Šå¥½?</p>
<ol>
<li>çº¿ç¨‹åœ¨javaä¸­æ˜¯ä¸€ä¸ªå¯¹è±¡,æ›´æ˜¯æ“ä½œç³»ç»Ÿçš„èµ„æº,çº¿ç¨‹åˆ›å»ºã€é”€æ¯éœ€è¦æ—¶é—´ã€‚å¦‚æœåˆ›å»ºæ—¶é—´+é”€æ¯æ—¶é—´&gt;æ‰§è¡Œä»»åŠ¡æ—¶é—´å°±å¾ˆä¸åˆç®—ã€‚</li>
<li>javaå¯¹è±¡å ç”¨å †å†…å­˜,æ“ä½œç³»ç»Ÿçº¿ç¨‹å ç”¨ç³»ç»Ÿå†…å­˜,æ ¹æ®jÎ½mè§„èŒƒ,ä¸€ä¸ªçº¿ç¨‹é»˜è®¤æœ€å¤§æ ˆå¤§å°1M,è¿™ä¸ªæ ˆç©ºé—´æ˜¯éœ€è¦ä»ç³»ç»Ÿå†…å­˜ä¸­åˆ†é…çš„ã€‚çº¿ç¨‹è¿‡å¤š,ä¼šæ¶ˆè€—å¾ˆå¤šçš„å…§å­˜ã€‚</li>
<li>æ“ä½œç³»ç»Ÿéœ€è¦é¢‘ç¹åˆ‡æ¢çº¿ç¨‹ä¸Šä¸‹æ–‡(å¤§å®¶éƒ½æƒ³è¢«è¿è¡Œ),å½±å“æ€§èƒ½ã€‚</li>
</ol>
<p>çº¿ç¨‹æ± çš„æ¨å‡º,å°±æ˜¯ä¸ºäº†æ–¹ä¾¿çš„æ§åˆ¶çº¿ç¨‹æ•°é‡ã€‚</p>
<h2 id="çº¿ç¨‹æ± åŸç†-æ¦‚å¿µ">çº¿ç¨‹æ± åŸç† - æ¦‚å¿µ</h2>
<h4 id="çº¿ç¨‹æ± ç®¡ç†å™¨">çº¿ç¨‹æ± ç®¡ç†å™¨</h4>
<p>ç”¨äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹æ± ,åŒ…æ‹¬åˆ›å»ºçº¿ç¨‹æ± ,é”€æ¯çº¿ç¨‹æ± ,æ·»åŠ æ–°ä»»åŠ¡;</p>
<h4 id="å·¥ä½œçº¿ç¨‹">å·¥ä½œçº¿ç¨‹</h4>
<p>çº¿ç¨‹æ± ä¸­çº¿ç¨‹,åœ¨æ²¡æœ‰ä»»åŠ¡æ—¶å¤„äºç­‰å¾…çŠ¶æ€,å¯ä»¥å¾ªç¯çš„æ‰§è¡Œä»»åŠ¡;</p>
<h4 id="ä»»åŠ¡æ¥å£">ä»»åŠ¡æ¥å£</h4>
<p>æ¯ä¸ªä»»åŠ¡å¿…é¡»å®ç°çš„æ¥å£,ä»¥ä¾›å·¥ä½œçº¿ç¨‹è°ƒåº¦ä»»åŠ¡çš„æ‰§è¡Œ,å®ƒä¸»è¦è§„å®šäº†ä»»åŠ¡çš„å…¥å£,ä»»åŠ¡æ‰§è¡Œå®Œåçš„æ”¶å°¾å·¥ä½œ,ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ç­‰;</p>
<h4 id="ä»»åŠ¡é˜Ÿåˆ—">ä»»åŠ¡é˜Ÿåˆ—</h4>
<p>ç”¨äºå­˜æ”¾æ²¡æœ‰å¤„ç†çš„ä»»åŠ¡ã€‚æä¾›ä¸€ç§ç¼“å†²æœºåˆ¶ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://static.sunjianbo.com/image-20200805095038062.png" alt="" loading="lazy"></figure>
<h2 id="çº¿ç¨‹æ± api-æ¥å£å®šä¹‰å’Œå®ç°ç±»">çº¿ç¨‹æ± API - æ¥å£å®šä¹‰å’Œå®ç°ç±»</h2>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ¥å£</td>
<td>Executor</td>
<td>æœ€ä¸Šå±‚çš„æ¥å£,å®šä¹‰äº†<font color=red>æ‰§è¡Œä»»åŠ¡çš„æ–¹æ³• execute</font></td>
</tr>
<tr>
<td>æ¥å£</td>
<td>ExecutorService</td>
<td>ç»§æ‰¿äº† Executoræ¥å£,æ‹“å±•äº† Callableã€ Futureã€å…³é—­æ–¹æ³•</td>
</tr>
<tr>
<td>æ¥å£</td>
<td>ScheduledExecutorService</td>
<td>ç»§æ‰¿äº† ExecutorService,å¢åŠ äº†å®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ–¹æ³•</td>
</tr>
<tr>
<td>å®ç°ç±»</td>
<td>ThreadPoolExecutor</td>
<td><font color=red>åŸºç¡€ã€æ ‡å‡†çš„çº¿ç¨‹æ± å®ç°</font></td>
</tr>
<tr>
<td>å®ç°ç±»</td>
<td>ScheduledThreadPoolExecutor</td>
<td>ç»§æ‰¿äº† ThreadPoolExecutor,å®ç°äº†ScheduledExecutorServiceä¸­ç›¸å…³<font color=red>å®šæ—¶ä»»åŠ¡</font>çš„æ–¹æ³•</td>
</tr>
</tbody>
</table>
<h2 id="çº¿ç¨‹æ± api-æ–¹æ³•å®šä¹‰">çº¿ç¨‹æ± API - æ–¹æ³•å®šä¹‰</h2>
<h3 id="executorservice">ExecutorService</h3>
<pre><code class="language-java">//ç›‘æµ‹ExecutorServiceæ˜¯å¦å·²ç»å…³é—­ï¼Œ ç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆæ‰§è¡Œï¼Œæˆ–è¶…æ—¶å‘ç”Ÿï¼Œæˆ–å½“å‰çº¿ç¨‹è¢«ä¸­æ–­
awaitTermination(long timeout, TimeUnit unit)
//æ‰§è¡Œç»™å®šçš„ä»»åŠ¡é›†åˆï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œè¿”å›ç»“æœ
invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)
//æ‰§è¡Œç»™å®šçš„ä»»åŠ¡é›†åˆï¼Œæ‰§è¡Œå®Œæ¯•æˆ–è€…è¶…æ—¶åï¼Œè¿”å›ç»“æœï¼Œå…¶ä»–ä»»åŠ¡ç»ˆæ­¢
invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit)
//æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œä»»æ„ä¸€ä¸ªæ‰§è¡ŒæˆåŠŸåˆ™è¿”å›ç»“æœï¼Œå…¶ä»–ä»»åŠ¡ç»ˆæ­¢
invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)
//æ‰§è¡Œç»™å®šçš„ä»»åŠ¡ï¼Œä»»æ„ä¸€ä¸ªæ‰§è¡ŒæˆåŠŸæˆ–è€…è¶…æ—¶åï¼Œåˆ™è¿”å›ç»“æœï¼Œå…¶ä»–ä»»åŠ¡ç»ˆæ­¢
invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit)
//å¦‚æœæ­¤çº¿ç¨‹æ± å·²å…³é—­ï¼Œåˆ™è¿”å›trueã€‚
isShutdown()
//å¦‚æœå…³é—­åæ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆï¼Œåˆ™è¿”å›trueã€‚
isTerminated()
//ä¼˜é›…å…³é—­çº¿ç¨‹æ± ï¼Œä¹‹å‰æäº¤çš„ä»»åŠ¡å°†è¢«æ‰§è¡Œï¼Œä½†æ˜¯ä¸ä¼šæ¥å—æ–°çš„ä»»åŠ¡ã€‚
shutdown()
//å°è¯•åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œåœæ­¢ç­‰å¾…ä»»åŠ¡çš„å¤„ç†ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„åˆ—è¡¨ã€‚
shutdownNow()
//æäº¤ä¸ªç”¨äºæ‰§è¡Œçš„Callableè¿”å›ä»»åŠ¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªFuture,ç”¨äºè·å–Callableæ‰§è¡Œç»“æœ
submit(Callable&lt;T&gt; task)
//æäº¤å¯è¿è¡Œä»»åŠ¡ä»¥æ‰§è¡Œï¼Œå¹¶å‘å›ä¸€ä¸ªFutureå¯¹è±¡ï¼Œæ‰§è¡Œç»“æœä¸ºnull
submit(Runnable task)
//æäº¤å¯è¿è¡Œä»»åŠ¡ä»¥æ‰§è¡Œï¼Œå¹¶è¿”å›Future, æ‰§è¡Œç»“æœä¸ºä¼ å…¥çš„result
submit(Runnable task, T result)
</code></pre>
<h3 id="scheduledexecutorservice">ScheduledExecutorService</h3>
<ul>
<li>
<p><code>schedule(Callable&lt;V&gt; callable, long delay, TimeUnit unit)</code></p>
<p>åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªä¸€æ¬¡æ€§ä»»åŠ¡,è¿‡äº†å»¶è¿Ÿæ—¶é—´å°±ä¼šè¢«æ‰§è¡Œ</p>
</li>
<li>
<p><code>schedule(Callable&lt;V&gt; callable, long delay, TimeUnit unit)</code></p>
<p>åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªä¸€æ¬¡æ€§ä»»åŠ¡,è¿‡äº†å»¶è¿Ÿæ—¶é—´å°±ä¼šè¢«æ‰§è¡Œ</p>
</li>
<li>
<p><code>scheduleAtFixedRate(Runnable command, long initialDelay, long period, TimeUnit unit)</code></p>
<p>åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªå‘¨æœŸæ€§ä»»åŠ¡è¿‡äº†ç»™å®šçš„åˆå§‹å»¶è¿Ÿæ—¶é—´,ä¼šç¬¬ä¸€æ¬¡è¢«æ‰§è¡Œ</p>
<p>æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸,é‚£ä¹ˆä»»åŠ¡å°±åœæ­¢</p>
<p>ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œæ—¶é•¿è¶…è¿‡äº†å‘¨æœŸæ—¶é—´,ä¸‹ä¸€æ¬¡ä»»åŠ¡ä¼šç­‰åˆ°è¯¥æ¬¡ä»»åŠ¡æ‰§è¡Œç»“æŸå,ç«‹åˆ»æ‰§è¡Œ,è¿™ä¹Ÿæ˜¯å®ƒå’Œ<code>scheduleWithFixedDelay</code>çš„é‡è¦åŒºåˆ«ã€‚<br>
æ­¤å¤„ç»“åˆä»£ç ç¤ºä¾‹è¿›è¡Œç†è§£å³å¯!</p>
</li>
<li>
<p><code>scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit)</code></p>
<p>åˆ›å»ºå¹¶æ‰§è¡Œä¸€ä¸ªå‘¨æœŸæ€§ä»»åŠ¡,è¿‡äº†åˆå§‹å»¶è¿Ÿæ—¶é—´,ç¬¬ä¸€æ¬¡è¢«æ‰§è¡Œ,åç»­ä»¥ç»™å®šçš„å‘¨æœŸæ—¶é—´æ‰§è¡Œ</p>
<p>æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸,é‚£ä¹ˆä»»åŠ¡å°±åœæ­¢</p>
<p>ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œæ—¶é•¿è¶…è¿‡äº†å‘¨æœŸæ—¶é—´,ä¸‹ä¸€æ¬¡ä»»åŠ¡ä¼šåœ¨è¯¥æ¬¡ä»»åŠ¡æ‰§è¡Œç»“æŸçš„æ—¶é—´åŸºç¡€ä¸Š,è®¡ç®—æ‰§è¡Œå»¶æ—¶ã€‚</p>
<p>å¯¹äºè¶…è¿‡å‘¨æœŸçš„é•¿æ—¶é—´å¤„ç†ä»»åŠ¡çš„ä¸åŒå¤„ç†æ–¹å¼,è¿™æ˜¯å®ƒå’Œ<code>scheduleAtFixedRate</code>çš„é‡è¦åŒºåˆ«ã€‚</p>
</li>
</ul>
<h2 id="çº¿ç¨‹æ± api-executorså·¥å…·ç±»">çº¿ç¨‹æ± API - Executorså·¥å…·ç±»</h2>
<p>ä½ å¯ä»¥è‡ªå·±å®ä¾‹åŒ–çº¿ç¨‹æ± ,ä¹Ÿå¯ä»¥ç”¨ Executorsåˆ›å»ºçº¿ç¨‹æ± çš„å·¥å‚ç±»,å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹:</p>
<h3 id="newfixedthreadpoolint-nthreads">newFixedThreadPool(int nThreads)</h3>
<p>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°ã€ä»»åŠ¡é˜Ÿåˆ—å®¹é‡æ— ç•Œçš„çº¿ç¨‹æ± ã€‚æ ¸å¿ƒçº¿ç¨‹æ•°=æœ€å¤§çº¿ç¨‹æ•°ã€‚</p>
<h3 id="newcachedthreadpool">newCachedThreadPool()</h3>
<p>åˆ›å»ºçš„æ˜¯ä¸€ä¸ªå¤§å°æ— ç•Œçš„ç¼“å†²çº¿ç¨‹æ± ã€‚å®ƒçš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—ã€‚</p>
<p>ä»»åŠ¡åŠ å…¥åˆ°æ± ä¸­,å¦‚æœæ± ä¸­æœ‰ç©ºé—²çº¿ç¨‹,åˆ™ç”¨ç©ºé—²çº¿ç¨‹æ‰§è¡Œ,å¦‚æ— åˆ™åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œã€‚</p>
<p>æ± ä¸­çš„çº¿ç¨‹ç©ºé—²è¶…è¿‡60ç§’,å°†è¢«é”€æ¯é‡Šæ”¾ã€‚çº¿ç¨‹æ•°éšä»»åŠ¡çš„å¤šå°‘å˜åŒ–ã€‚</p>
<p>é€‚ç”¨äºæ‰§è¡Œè€—æ—¶è¾ƒå°çš„å¼‚æ­¥ä»»åŠ¡ã€‚æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°=0,æœ€å¤§çº¿ç¨‹æ•°= <code>Integer.MAX_VALUE</code></p>
<h3 id="newsinglethreadexecutor">newSingleThreadExecutor()</h3>
<p>åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ— ç•Œä»»åŠ¡é˜Ÿåˆ—çš„å•ä¸€çº¿ç¨‹æ± ã€‚</p>
<p>è¯¥çº¿ç¨‹æ± ç¡®ä¿ä»»åŠ¡æŒ‰åŠ å…¥çš„é¡ºåºä¸€ä¸ªä¸ªä¾æ¬¡æ‰§è¡Œã€‚å½“å”¯ä¸€çš„çº¿ç¨‹å› ä»»åŠ¡å¼‚å¸¸ä¸­æ­¢æ—¶,å°†åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥ç»§ç»­æ‰§è¡Œåç»­çš„ä»»åŠ¡ã€‚</p>
<p>ä¸ <code>newFixedThreadPool(1)</code>çš„åŒºåˆ«åœ¨äº,å•ä¸€çº¿ç¨‹æ± çš„æ± å¤§å°åœ¨<code>newSingleThreadExecutor</code>æ–¹æ³•ä¸­ç¡¬ç¼–ç ,ä¸èƒ½å†æ”¹å˜çš„ã€‚</p>
<h3 id="newscheduledthreadpoolint-corepoolsize">newScheduledThreadPool(int corePoolSize)</h3>
<p>èƒ½å®šæ—¶æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚è¯¥æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°ç”±å‚æ•°æŒ‡å®š,æœ€å¤§çº¿ç¨‹æ•°= <code>Integer.MAX_VALUE</code></p>
<h2 id="çº¿ç¨‹æ± åŸç†-ä»»åŠ¡executeè¿‡ç¨‹">çº¿ç¨‹æ± åŸç†-ä»»åŠ¡executeè¿‡ç¨‹</h2>
<ol>
<li>
<p>æ˜¯å¦è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°é‡?</p>
<p>æ²¡è¾¾åˆ°,åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
</li>
<li>
<p>å·¥ä½œé˜Ÿåˆ—æ˜¯å¦å·²æ»¡?</p>
<p>æ²¡æ»¡,åˆ™å°†æ–°æäº¤çš„ä»»åŠ¡å­˜å‚¨åœ¨å·¥ä½œé˜Ÿåˆ—é‡Œã€‚</p>
</li>
<li>
<p>æ˜¯å¦è¾¾åˆ°çº¿ç¨‹æ± æœ€å¤§æ•°é‡?</p>
<p>æ²¡è¾¾åˆ°,åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
</li>
<li>
<p>æœ€å,æ‰§è¡Œæ‹’ç»ç­–ç•¥æ¥å¤„ç†è¿™ä¸ªä»»åŠ¡ã€‚</p>
</li>
</ol>
<figure data-type="image" tabindex="2"><img src="https://static.sunjianbo.com/image-20200806112820086.png" alt="" loading="lazy"></figure>
<h2 id="å®è·µ-åˆé€‚çš„çº¿ç¨‹æ•°é‡">å®è·µ - åˆé€‚çš„çº¿ç¨‹æ•°é‡</h2>
<p>å¦‚ä½•ç¡®å®šåˆé€‚æ•°é‡çš„çº¿ç¨‹?</p>
<ul>
<li>
<p>è®¡ç®—å‹ä»»åŠ¡:</p>
<p>CPUæ•°é‡çš„1-2å€</p>
</li>
<li>
<p>IOå‹ä»»åŠ¡:</p>
<p>ç›¸å¯¹æ¯”è®¡ç®—å‹ä»»åŠ¡,éœ€å¤šä¸€äº›çº¿ç¨‹,è¦æ ¹æ®å…·ä½“çš„<u>IOé˜»å¡æ—¶é•¿</u>è¿›è¡Œè€ƒé‡å†³å®šã€‚<br>
å¦‚ tomcatä¸­é»˜è®¤çš„æœ€å¤§çº¿ç¨‹æ•°ä¸º: 200ã€‚</p>
</li>
</ul>
<p>ä¹Ÿå¯è€ƒè™‘æ ¹æ®éœ€è¦åœ¨ä¸€ä¸ª<u>æœ€å°æ•°é‡å’Œæœ€å¤§æ•°é‡é—´</u>è‡ªåŠ¨å¢å‡çº¿ç¨‹æ•°ã€‚(<code>newCachedThreadPool</code>)</p>
<h2 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹:</h2>
<pre><code class="language-java">import java.util.List;
import java.util.concurrent.LinkedBlockingQueue;
import java.util.concurrent.RejectedExecutionHandler;
import java.util.concurrent.ScheduledThreadPoolExecutor;
import java.util.concurrent.SynchronousQueue;
import java.util.concurrent.ThreadPoolExecutor;
import java.util.concurrent.TimeUnit;

/** çº¿ç¨‹æ± çš„ä½¿ç”¨ */
public class Demo9 {

	/**
	 * æµ‹è¯•ï¼š æäº¤15ä¸ªæ‰§è¡Œæ—¶é—´éœ€è¦3ç§’çš„ä»»åŠ¡,çœ‹çº¿ç¨‹æ± çš„çŠ¶å†µ
	 * 
	 * @param threadPoolExecutor ä¼ å…¥ä¸åŒçš„çº¿ç¨‹æ± ï¼Œçœ‹ä¸åŒçš„ç»“æœ
	 * @throws Exception
	 */
	public void testCommon(ThreadPoolExecutor threadPoolExecutor) throws Exception {
		// æµ‹è¯•ï¼š æäº¤15ä¸ªæ‰§è¡Œæ—¶é—´éœ€è¦3ç§’çš„ä»»åŠ¡ï¼Œçœ‹è¶…è¿‡å¤§å°çš„2ä¸ªï¼Œå¯¹åº”çš„å¤„ç†æƒ…å†µ
		for (int i = 0; i &lt; 15; i++) {
			int n = i;
			threadPoolExecutor.submit(new Runnable() {
				@Override
				public void run() {
					try {
						System.out.println(&quot;å¼€å§‹æ‰§è¡Œï¼š&quot; + n);
						Thread.sleep(3000L);
						System.err.println(&quot;æ‰§è¡Œç»“æŸ:&quot; + n);
					} catch (InterruptedException e) {
						e.printStackTrace();
					}
				}
			});
			System.out.println(&quot;ä»»åŠ¡æäº¤æˆåŠŸ :&quot; + i);
		}
		// æŸ¥çœ‹çº¿ç¨‹æ•°é‡ï¼ŒæŸ¥çœ‹é˜Ÿåˆ—ç­‰å¾…æ•°é‡
		Thread.sleep(500L);
		System.out.println(&quot;å½“å‰çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡ä¸ºï¼š&quot; + threadPoolExecutor.getPoolSize());
		System.out.println(&quot;å½“å‰çº¿ç¨‹æ± ç­‰å¾…çš„æ•°é‡ä¸ºï¼š&quot; + threadPoolExecutor.getQueue().size());
		// ç­‰å¾…15ç§’ï¼ŒæŸ¥çœ‹çº¿ç¨‹æ•°é‡å’Œé˜Ÿåˆ—æ•°é‡ï¼ˆç†è®ºä¸Šï¼Œä¼šè¢«è¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹è‡ªåŠ¨é”€æ¯ï¼‰
		Thread.sleep(15000L);
		System.out.println(&quot;å½“å‰çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡ä¸ºï¼š&quot; + threadPoolExecutor.getPoolSize());
		System.out.println(&quot;å½“å‰çº¿ç¨‹æ± ç­‰å¾…çš„æ•°é‡ä¸ºï¼š&quot; + threadPoolExecutor.getQueue().size());
	}

	/**
	 * æ ‡å‡†çº¿ç¨‹æ± 
	 * 1ã€çº¿ç¨‹æ± ä¿¡æ¯ï¼š æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ï¼Œæœ€å¤§æ•°é‡10ï¼Œæ— ç•Œé˜Ÿåˆ—ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š5ç§’ï¼Œ æŒ‡å®šæ‹’ç»ç­–ç•¥çš„
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest1() throws Exception {
		ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(5, 10, 5, TimeUnit.SECONDS,
				new LinkedBlockingQueue&lt;Runnable&gt;());

		testCommon(threadPoolExecutor);
		// é¢„è®¡ç»“æœï¼šçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡ä¸ºï¼š5,è¶…å‡ºæ•°é‡çš„ä»»åŠ¡ï¼Œå…¶ä»–çš„è¿›å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«æ‰§è¡Œ
	}

	/**
	 * æœ‰æ‹’ç»ç­–ç•¥çš„
	 * 2ã€ çº¿ç¨‹æ± ä¿¡æ¯ï¼š æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ï¼Œæœ€å¤§æ•°é‡10ï¼Œé˜Ÿåˆ—å¤§å°3ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š5ç§’ï¼Œ æŒ‡å®šæ‹’ç»ç­–ç•¥çš„
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest2() throws Exception {
		// åˆ›å»ºä¸€ä¸ª æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º5ï¼Œæœ€å¤§æ•°é‡ä¸º10,ç­‰å¾…é˜Ÿåˆ—æœ€å¤§æ˜¯3 çš„çº¿ç¨‹æ± ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§å®¹çº³13ä¸ªä»»åŠ¡ã€‚
		// é»˜è®¤çš„ç­–ç•¥æ˜¯æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ï¼Œjava.util.concurrent.ThreadPoolExecutor.AbortPolicy
		ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(5, 10, 5, TimeUnit.SECONDS,
				new LinkedBlockingQueue&lt;Runnable&gt;(3), new RejectedExecutionHandler() {
					@Override
					public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
						System.err.println(&quot;æœ‰ä»»åŠ¡è¢«æ‹’ç»æ‰§è¡Œäº†&quot;);
					}
				});
		testCommon(threadPoolExecutor);
		// é¢„è®¡ç»“æœï¼š
		// 1ã€ 5ä¸ªä»»åŠ¡ç›´æ¥åˆ†é…çº¿ç¨‹å¼€å§‹æ‰§è¡Œ
		// 2ã€ 3ä¸ªä»»åŠ¡è¿›å…¥ç­‰å¾…é˜Ÿåˆ—
		// 3ã€ é˜Ÿåˆ—ä¸å¤Ÿç”¨ï¼Œä¸´æ—¶åŠ å¼€5ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡(5ç§’æ²¡æ´»å¹²å°±é”€æ¯)
		// 4ã€ é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œå‰©ä¸‹2ä¸ªä»»åŠ¡ï¼Œæ²¡èµ„æºäº†ï¼Œè¢«æ‹’ç»æ‰§è¡Œã€‚
		// 5ã€ ä»»åŠ¡æ‰§è¡Œï¼Œ5ç§’åï¼Œå¦‚æœæ— ä»»åŠ¡å¯æ‰§è¡Œï¼Œé”€æ¯ä¸´æ—¶åˆ›å»ºçš„5ä¸ªçº¿ç¨‹
	}

	/**
	 * è‡ªå®šä¹‰Executors.newFixedThreadPool(int nThreads)
	 * 3ã€ çº¿ç¨‹æ± ä¿¡æ¯ï¼š æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ï¼Œæœ€å¤§æ•°é‡5ï¼Œæ— ç•Œé˜Ÿåˆ—ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š5ç§’
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest3() throws Exception {
		// å’ŒExecutors.newFixedThreadPool(int nThreads)ä¸€æ ·çš„
		ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(5, 5, 0L, TimeUnit.MILLISECONDS,
				new LinkedBlockingQueue&lt;Runnable&gt;());
		testCommon(threadPoolExecutor);
		// é¢„è®¡ç»“ï¼šçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡ä¸ºï¼š5ï¼Œè¶…å‡ºæ•°é‡çš„ä»»åŠ¡ï¼Œå…¶ä»–çš„è¿›å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«æ‰§è¡Œ
	}

	/**
	 * è‡ªå®šä¹‰Executors.newCachedThreadPool()
	 * 4ã€ çº¿ç¨‹æ± ä¿¡æ¯ï¼š
	 * æ ¸å¿ƒçº¿ç¨‹æ•°é‡0ï¼Œæœ€å¤§æ•°é‡Integer.MAX_VALUEï¼ŒSynchronousQueueé˜Ÿåˆ—ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š60ç§’
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest4() throws Exception {

		// SynchronousQueueï¼Œå®é™…ä¸Šå®ƒä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é˜Ÿåˆ—ï¼Œå› ä¸ºå®ƒä¸ä¼šä¸ºé˜Ÿåˆ—ä¸­å…ƒç´ ç»´æŠ¤å­˜å‚¨ç©ºé—´ã€‚ä¸å…¶ä»–é˜Ÿåˆ—ä¸åŒçš„æ˜¯ï¼Œå®ƒç»´æŠ¤ä¸€ç»„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹åœ¨ç­‰å¾…ç€æŠŠå…ƒç´ åŠ å…¥æˆ–ç§»å‡ºé˜Ÿåˆ—ã€‚
		// åœ¨ä½¿ç”¨SynchronousQueueä½œä¸ºå·¥ä½œé˜Ÿåˆ—çš„å‰æä¸‹ï¼Œå®¢æˆ·ç«¯ä»£ç å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡æ—¶ï¼Œ
		// è€Œçº¿ç¨‹æ± ä¸­åˆæ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹èƒ½å¤Ÿä»SynchronousQueueé˜Ÿåˆ—å®ä¾‹ä¸­å–ä¸€ä¸ªä»»åŠ¡ï¼Œ
		// é‚£ä¹ˆç›¸åº”çš„offeræ–¹æ³•è°ƒç”¨å°±ä¼šå¤±è´¥ï¼ˆå³ä»»åŠ¡æ²¡æœ‰è¢«å­˜å…¥å·¥ä½œé˜Ÿåˆ—ï¼‰ã€‚
		// æ­¤æ—¶ï¼ŒThreadPoolExecutorä¼šæ–°å»ºä¸€ä¸ªæ–°çš„å·¥ä½œè€…çº¿ç¨‹ç”¨äºå¯¹è¿™ä¸ªå…¥é˜Ÿåˆ—å¤±è´¥çš„ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼ˆå‡è®¾æ­¤æ—¶çº¿ç¨‹æ± çš„å¤§å°è¿˜æœªè¾¾åˆ°å…¶æœ€å¤§çº¿ç¨‹æ± å¤§å°maximumPoolSizeï¼‰ã€‚

		// å’ŒExecutors.newCachedThreadPool()ä¸€æ ·çš„
		ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS,
				new SynchronousQueue&lt;Runnable&gt;());
		testCommon(threadPoolExecutor);
		// é¢„è®¡ç»“æœï¼š
		// 1ã€ çº¿ç¨‹æ± çº¿ç¨‹æ•°é‡ä¸ºï¼š15ï¼Œè¶…å‡ºæ•°é‡çš„ä»»åŠ¡ï¼Œå…¶ä»–çš„è¿›å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…è¢«æ‰§è¡Œ
		// 2ã€ æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œ60ç§’åï¼Œå¦‚æœæ— ä»»åŠ¡å¯æ‰§è¡Œï¼Œæ‰€æœ‰çº¿ç¨‹å…¨éƒ¨è¢«é”€æ¯ï¼Œæ± çš„å¤§å°æ¢å¤ä¸º0
		Thread.sleep(60000L);
		System.out.println(&quot;60ç§’åï¼Œå†çœ‹çº¿ç¨‹æ± ä¸­çš„æ•°é‡ï¼š&quot; + threadPoolExecutor.getPoolSize());
	}

	/**
	 * å»¶è¿Ÿæ‰§è¡Œ
	 * 5ã€ å®šæ—¶æ‰§è¡Œçº¿ç¨‹æ± ä¿¡æ¯ï¼š3ç§’åæ‰§è¡Œï¼Œä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œåˆ°ç‚¹å°±æ‰§è¡Œ &lt;br/&gt;
	 * æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ï¼Œæœ€å¤§æ•°é‡Integer.MAX_VALUEï¼ŒDelayedWorkQueueå»¶æ—¶é˜Ÿåˆ—ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š0ç§’
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest5() throws Exception {
		// å’ŒExecutors.newScheduledThreadPool()ä¸€æ ·çš„
		ScheduledThreadPoolExecutor threadPoolExecutor = new ScheduledThreadPoolExecutor(5);
		threadPoolExecutor.schedule(new Runnable() {
			@Override
			public void run() {
				System.out.println(&quot;ä»»åŠ¡è¢«æ‰§è¡Œï¼Œç°åœ¨æ—¶é—´ï¼š&quot; + System.currentTimeMillis());
			}
		}, 3000, TimeUnit.MILLISECONDS);
		System.out.println(
				&quot;å®šæ—¶ä»»åŠ¡ï¼Œæäº¤æˆåŠŸï¼Œæ—¶é—´æ˜¯ï¼š&quot; + System.currentTimeMillis() + &quot;, å½“å‰çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡ï¼š&quot; + threadPoolExecutor.getPoolSize());
		// é¢„è®¡ç»“æœï¼šä»»åŠ¡åœ¨3ç§’åè¢«æ‰§è¡Œä¸€æ¬¡
	}

	/**
	 * å‘¨æœŸæ€§æ‰§è¡Œ
	 * 6ã€ å®šæ—¶æ‰§è¡Œçº¿ç¨‹æ± ä¿¡æ¯ï¼šçº¿ç¨‹å›ºå®šæ•°é‡5 ï¼Œ&lt;br/&gt;
	 * æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ï¼Œæœ€å¤§æ•°é‡Integer.MAX_VALUEï¼ŒDelayedWorkQueueå»¶æ—¶é˜Ÿåˆ—ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š0ç§’
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest6() throws Exception {
		ScheduledThreadPoolExecutor threadPoolExecutor = new ScheduledThreadPoolExecutor(5);
		// å‘¨æœŸæ€§æ‰§è¡ŒæŸä¸€ä¸ªä»»åŠ¡ï¼Œçº¿ç¨‹æ± æä¾›äº†ä¸¤ç§è°ƒåº¦æ–¹å¼ï¼Œè¿™é‡Œå•ç‹¬æ¼”ç¤ºä¸€ä¸‹ã€‚æµ‹è¯•åœºæ™¯ä¸€æ ·ã€‚
		// æµ‹è¯•åœºæ™¯ï¼šæäº¤çš„ä»»åŠ¡éœ€è¦3ç§’æ‰èƒ½æ‰§è¡Œå®Œæ¯•ã€‚çœ‹ä¸¤ç§ä¸åŒè°ƒåº¦æ–¹å¼çš„åŒºåˆ«
		// æ•ˆæœ1ï¼š æäº¤åï¼Œ2ç§’åå¼€å§‹ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œä¹‹åæ¯é—´éš”1ç§’ï¼Œå›ºå®šæ‰§è¡Œä¸€æ¬¡(å¦‚æœå‘ç°ä¸Šæ¬¡æ‰§è¡Œè¿˜æœªå®Œæ¯•ï¼Œåˆ™ç­‰å¾…å®Œæ¯•ï¼Œå®Œæ¯•åç«‹åˆ»æ‰§è¡Œ)ã€‚
		// ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªä»£ç ä¸­æ˜¯ï¼Œ3ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆè®¡ç®—æ–¹å¼ï¼šæ¯æ¬¡æ‰§è¡Œä¸‰ç§’ï¼Œé—´éš”æ—¶é—´1ç§’ï¼Œæ‰§è¡Œç»“æŸåé©¬ä¸Šå¼€å§‹ä¸‹ä¸€æ¬¡æ‰§è¡Œï¼Œæ— éœ€ç­‰å¾…ï¼‰
		threadPoolExecutor.scheduleAtFixedRate(new Runnable() {
			@Override
			public void run() {
				try {
					Thread.sleep(3000L);
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
				System.out.println(&quot;ä»»åŠ¡-1 è¢«æ‰§è¡Œï¼Œç°åœ¨æ—¶é—´ï¼š&quot; + System.currentTimeMillis());
			}
		}, 2000, 1000, TimeUnit.MILLISECONDS);

		// æ•ˆæœ2ï¼šæäº¤åï¼Œ2ç§’åå¼€å§‹ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼Œä¹‹åæ¯é—´éš”1ç§’ï¼Œå›ºå®šæ‰§è¡Œä¸€æ¬¡(å¦‚æœå‘ç°ä¸Šæ¬¡æ‰§è¡Œè¿˜æœªå®Œæ¯•ï¼Œåˆ™ç­‰å¾…å®Œæ¯•ï¼Œç­‰ä¸Šä¸€æ¬¡æ‰§è¡Œå®Œæ¯•åå†å¼€å§‹è®¡æ—¶ï¼Œç­‰å¾…1ç§’)ã€‚
		// ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªä»£ç é’Ÿçš„æ•ˆæœçœ‹åˆ°çš„æ˜¯ï¼š4ç§’æ‰§è¡Œä¸€æ¬¡ã€‚ ï¼ˆè®¡ç®—æ–¹å¼ï¼šæ¯æ¬¡æ‰§è¡Œ3ç§’ï¼Œé—´éš”æ—¶é—´1ç§’ï¼Œæ‰§è¡Œå®Œä»¥åå†ç­‰å¾…1ç§’ï¼Œæ‰€ä»¥æ˜¯ 3+1ï¼‰
		threadPoolExecutor.scheduleWithFixedDelay(new Runnable() {
			@Override
			public void run() {
				try {
					Thread.sleep(3000L);
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
				System.out.println(&quot;ä»»åŠ¡-2 è¢«æ‰§è¡Œï¼Œç°åœ¨æ—¶é—´ï¼š&quot; + System.currentTimeMillis());
			}
		}, 2000, 1000, TimeUnit.MILLISECONDS);
	}

	/**
	 * 7ã€ ç»ˆæ­¢çº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¿¡æ¯ï¼š æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ï¼Œæœ€å¤§æ•°é‡10ï¼Œé˜Ÿåˆ—å¤§å°3ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š5ç§’ï¼Œ æŒ‡å®šæ‹’ç»ç­–ç•¥çš„
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest7() throws Exception {
		// åˆ›å»ºä¸€ä¸ª æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º5ï¼Œæœ€å¤§æ•°é‡ä¸º10,ç­‰å¾…é˜Ÿåˆ—æœ€å¤§æ˜¯3 çš„çº¿ç¨‹æ± ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§å®¹çº³13ä¸ªä»»åŠ¡ã€‚
		// é»˜è®¤çš„ç­–ç•¥æ˜¯æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ï¼Œjava.util.concurrent.ThreadPoolExecutor.AbortPolicy
		ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(5, 10, 5, TimeUnit.SECONDS,
				new LinkedBlockingQueue&lt;Runnable&gt;(3), new RejectedExecutionHandler() {
					@Override
					public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
						System.err.println(&quot;æœ‰ä»»åŠ¡è¢«æ‹’ç»æ‰§è¡Œäº†&quot;);
					}
				});
		// æµ‹è¯•ï¼š æäº¤15ä¸ªæ‰§è¡Œæ—¶é—´éœ€è¦3ç§’çš„ä»»åŠ¡ï¼Œçœ‹è¶…è¿‡å¤§å°çš„2ä¸ªï¼Œå¯¹åº”çš„å¤„ç†æƒ…å†µ
		for (int i = 0; i &lt; 15; i++) {
			int n = i;
			threadPoolExecutor.submit(new Runnable() {
				@Override
				public void run() {
					try {
						System.out.println(&quot;å¼€å§‹æ‰§è¡Œï¼š&quot; + n);
						Thread.sleep(3000L);
						System.err.println(&quot;æ‰§è¡Œç»“æŸ:&quot; + n);
					} catch (InterruptedException e) {
						System.out.println(&quot;å¼‚å¸¸ï¼š&quot; + e.getMessage());
					}
				}
			});
			System.out.println(&quot;ä»»åŠ¡æäº¤æˆåŠŸ :&quot; + i);
		}
		// 1ç§’åç»ˆæ­¢çº¿ç¨‹æ± 
		Thread.sleep(1000L);
		threadPoolExecutor.shutdown();
		// å†æ¬¡æäº¤æç¤ºå¤±è´¥
		threadPoolExecutor.submit(new Runnable() {
			@Override
			public void run() {
				System.out.println(&quot;è¿½åŠ ä¸€ä¸ªä»»åŠ¡&quot;);
			}
		});
		// ç»“æœåˆ†æ
		// 1ã€ 10ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œ3ä¸ªä»»åŠ¡è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œ2ä¸ªä»»åŠ¡è¢«æ‹’ç»æ‰§è¡Œ
		// 2ã€è°ƒç”¨shutdownåï¼Œä¸æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œç­‰å¾…13ä»»åŠ¡æ‰§è¡Œç»“æŸ
		// 3ã€ è¿½åŠ çš„ä»»åŠ¡åœ¨çº¿ç¨‹æ± å…³é—­åï¼Œæ— æ³•å†æäº¤ï¼Œä¼šè¢«æ‹’ç»æ‰§è¡Œ
	}

	/**
	 * 8ã€ ç«‹åˆ»ç»ˆæ­¢çº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¿¡æ¯ï¼š æ ¸å¿ƒçº¿ç¨‹æ•°é‡5ï¼Œæœ€å¤§æ•°é‡10ï¼Œé˜Ÿåˆ—å¤§å°3ï¼Œè¶…å‡ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼š5ç§’ï¼Œ æŒ‡å®šæ‹’ç»ç­–ç•¥çš„
	 * 
	 * @throws Exception
	 */
	private void threadPoolExecutorTest8() throws Exception {
		// åˆ›å»ºä¸€ä¸ª æ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º5ï¼Œæœ€å¤§æ•°é‡ä¸º10,ç­‰å¾…é˜Ÿåˆ—æœ€å¤§æ˜¯3 çš„çº¿ç¨‹æ± ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§å®¹çº³13ä¸ªä»»åŠ¡ã€‚
		// é»˜è®¤çš„ç­–ç•¥æ˜¯æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ï¼Œjava.util.concurrent.ThreadPoolExecutor.AbortPolicy
		ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(5, 10, 5, TimeUnit.SECONDS,
				new LinkedBlockingQueue&lt;Runnable&gt;(3), new RejectedExecutionHandler() {
					@Override
					public void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {
						System.err.println(&quot;æœ‰ä»»åŠ¡è¢«æ‹’ç»æ‰§è¡Œäº†&quot;);
					}
				});
		// æµ‹è¯•ï¼š æäº¤15ä¸ªæ‰§è¡Œæ—¶é—´éœ€è¦3ç§’çš„ä»»åŠ¡ï¼Œçœ‹è¶…è¿‡å¤§å°çš„2ä¸ªï¼Œå¯¹åº”çš„å¤„ç†æƒ…å†µ
		for (int i = 0; i &lt; 15; i++) {
			int n = i;
			threadPoolExecutor.submit(new Runnable() {
				@Override
				public void run() {
					try {
						System.out.println(&quot;å¼€å§‹æ‰§è¡Œï¼š&quot; + n);
						Thread.sleep(3000L);
						System.err.println(&quot;æ‰§è¡Œç»“æŸ:&quot; + n);
					} catch (InterruptedException e) {
						System.out.println(&quot;å¼‚å¸¸ï¼š&quot; + e.getMessage());
					}
				}
			});
			System.out.println(&quot;ä»»åŠ¡æäº¤æˆåŠŸ :&quot; + i);
		}
		// 1ç§’åç»ˆæ­¢çº¿ç¨‹æ± 
		Thread.sleep(1000L);
		List&lt;Runnable&gt; shutdownNow = threadPoolExecutor.shutdownNow();
		// å†æ¬¡æäº¤æç¤ºå¤±è´¥
		threadPoolExecutor.submit(new Runnable() {
			@Override
			public void run() {
				System.out.println(&quot;è¿½åŠ ä¸€ä¸ªä»»åŠ¡&quot;);
			}
		});
		System.out.println(&quot;æœªç»“æŸçš„ä»»åŠ¡æœ‰ï¼š&quot; + shutdownNow.size());

		// ç»“æœåˆ†æ
		// 1ã€ 10ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œ3ä¸ªä»»åŠ¡è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œ2ä¸ªä»»åŠ¡è¢«æ‹’ç»æ‰§è¡Œ
		// 2ã€è°ƒç”¨shutdownnowåï¼Œé˜Ÿåˆ—ä¸­çš„3ä¸ªçº¿ç¨‹ä¸å†æ‰§è¡Œï¼Œ10ä¸ªçº¿ç¨‹è¢«ç»ˆæ­¢
		// 3ã€ è¿½åŠ çš„ä»»åŠ¡åœ¨çº¿ç¨‹æ± å…³é—­åï¼Œæ— æ³•å†æäº¤ï¼Œä¼šè¢«æ‹’ç»æ‰§è¡Œ
	}

	public static void main(String[] args) throws Exception {
		new Demo9().threadPoolExecutorTest1();
//		new Demo9().threadPoolExecutorTest2();
//		new Demo9().threadPoolExecutorTest3();
//		new Demo9().threadPoolExecutorTest4();
//		new Demo9().threadPoolExecutorTest5();
//		new Demo9().threadPoolExecutorTest6();
//		new Demo9().threadPoolExecutorTest7();
//		new Demo9().threadPoolExecutorTest8();
	}
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[çº¿ç¨‹å°é—­ä¹‹ThreadLocalå’Œæ ˆå°é—­]]></title>
        <id>https://www.sunjianbo.com/thread-closure/</id>
        <link href="https://www.sunjianbo.com/thread-closure/">
        </link>
        <updated>2020-08-14T08:42:18.000Z</updated>
        <content type="html"><![CDATA[<h2 id="çº¿ç¨‹å°é—­çš„æ¦‚å¿µ">çº¿ç¨‹å°é—­çš„æ¦‚å¿µ</h2>
<p>å¤šçº¿ç¨‹è®¿é—®å…±äº«å¯å˜æ•°æ®æ—¶ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹é—´æ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰æ—¶å€™ï¼Œéƒ½è¦ç”¨åˆ°å…±äº«æ•°æ®ï¼Œæ‰€ä»¥çº¿ç¨‹å°é—­æ¦‚å¿µå°±æå‡ºæ¥äº†ã€‚</p>
<p>æ•°æ®éƒ½è¢«å°é—­åœ¨å„è‡ªçš„çº¿ç¨‹ä¹‹ä¸­ï¼Œå°±ä¸éœ€è¦åŒæ­¥ï¼Œè¿™ç§é€šè¿‡å°†æ•°æ®å°é—­åœ¨çº¿ç¨‹ä¸­è€Œé¿å…ä½¿ç”¨åŒæ­¥çš„æŠ€æœ¯ç§°ä¸º<strong>çº¿ç¨‹å°é—­</strong>ã€‚</p>
<p>çº¿ç¨‹å°é—­å…·ä½“çš„ä½“ç°æœ‰ï¼š <strong>Thread Local</strong>ã€<strong>å±€éƒ¨å˜é‡</strong></p>
<h2 id="threadlocal">ThreadLocal</h2>
<p>å®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹çº§åˆ«å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ª Thread Local,å°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰äº†è‡ªå·±ç‹¬ç«‹çš„ä¸€ä¸ªå˜é‡,ç«äº‰æ¡ä»¶è¢«å½»åº•æ¶ˆé™¤äº†ï¼Œåœ¨å¹¶å‘æ¨¡å¼ä¸‹æ˜¯ç»å¯¹å®‰å…¨çš„å˜é‡ã€‚</p>
<p>ç”¨æ³•ï¼š ThreadLocal<T>var= new ThreadLocal<T>()</p>
<p>ä¼šè‡ªåŠ¨åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸Šåˆ›å»ºä¸€ä¸ªTçš„å‰¯æœ¬ï¼Œå‰¯æœ¬ä¹‹é—´å½¼æ­¤ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ã€‚</p>
<p>å¯ä»¥ç”¨ ThreadLocalå­˜å‚¨ä¸€äº›å‚æ•°ï¼Œä»¥ä¾¿åœ¨çº¿ç¨‹ä¸­å¤šä¸ªæ–¹æ³•ä¸­ä½¿ç”¨ï¼Œç”¨æ¥ä»£æ›¿æ–¹æ³•ä¼ å‚çš„åšæ³•ã€‚</p>
<blockquote>
<p>å®åœ¨éš¾ä»¥ç†è§£çš„ï¼Œå¯ä»¥ç†è§£ä¸ºï¼ŒJVMç»´æŠ¤äº†ä¸€ä¸ª Map&lt; Thread,T&gt;,æ¯ä¸ªçº¿ç¨‹è¦ç”¨è¿™ä¸ªTçš„æ—¶å€™ï¼Œç”¨å½“å‰çš„çº¿ç¨‹å»Mapé‡Œé¢å–ã€‚ä»…ä½œä¸ºä¸€ä¸ªæ¦‚å¿µç†è§£</p>
</blockquote>
<p>ä»£ç ç¤ºä¾‹:</p>
<pre><code class="language-java">/** çº¿ç¨‹å°é—­ç¤ºä¾‹ */
public class Demo5 {
	/** threadLocalå˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰° */
	public static ThreadLocal&lt;String&gt; value = new ThreadLocal&lt;&gt;();

	/**
	 * threadlocalæµ‹è¯•
	 * 
	 * @throws Exception
	 */
	public void threadLocalTest() throws Exception {

		// threadlocalçº¿ç¨‹å°é—­ç¤ºä¾‹
		value.set(&quot;è¿™æ˜¯ä¸»çº¿ç¨‹è®¾ç½®çš„123&quot;); // ä¸»çº¿ç¨‹è®¾ç½®å€¼
		String v = value.get();
		System.out.println(&quot;çº¿ç¨‹1æ‰§è¡Œä¹‹å‰ï¼Œä¸»çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot; + v);

		new Thread(new Runnable() {
			@Override
			public void run() {
				String v = value.get();
				System.out.println(&quot;çº¿ç¨‹1å–åˆ°çš„å€¼ï¼š&quot; + v);
				// è®¾ç½® threadLocal
				value.set(&quot;è¿™æ˜¯çº¿ç¨‹1è®¾ç½®çš„456&quot;);

				v = value.get();
				System.out.println(&quot;é‡æ–°è®¾ç½®ä¹‹åï¼Œçº¿ç¨‹1å–åˆ°çš„å€¼ï¼š&quot; + v);
				System.out.println(&quot;çº¿ç¨‹1æ‰§è¡Œç»“æŸ&quot;);
			}
		}).start();

		Thread.sleep(5000L); // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç»“æŸ

		v = value.get();
		System.out.println(&quot;çº¿ç¨‹1æ‰§è¡Œä¹‹åï¼Œä¸»çº¿ç¨‹å–åˆ°çš„å€¼ï¼š&quot; + v);

	}

	public static void main(String[] args) throws Exception {
		new Demo5().threadLocalTest();
	}
}

</code></pre>
<p>è¿è¡Œç»“æœ:</p>
<blockquote>
<p>çº¿ç¨‹1æ‰§è¡Œä¹‹å‰ï¼Œä¸»çº¿ç¨‹å–åˆ°çš„å€¼ï¼šè¿™æ˜¯ä¸»çº¿ç¨‹è®¾ç½®çš„123<br>
çº¿ç¨‹1å–åˆ°çš„å€¼ï¼šnull<br>
é‡æ–°è®¾ç½®ä¹‹åï¼Œçº¿ç¨‹1å–åˆ°çš„å€¼ï¼šè¿™æ˜¯çº¿ç¨‹1è®¾ç½®çš„456<br>
çº¿ç¨‹1æ‰§è¡Œç»“æŸ<br>
çº¿ç¨‹1æ‰§è¡Œä¹‹åï¼Œä¸»çº¿ç¨‹å–åˆ°çš„å€¼ï¼šè¿™æ˜¯ä¸»çº¿ç¨‹è®¾ç½®çš„123</p>
</blockquote>
<h2 id="æ ˆå°é—­">æ ˆå°é—­</h2>
<p><strong>å±€éƒ¨å˜é‡</strong>çš„å›ºæœ‰å±æ€§ä¹‹ä¸€å°±æ˜¯å°é—­åœ¨çº¿ç¨‹ä¸­.</p>
<p>å®ƒä»¬ä½äºæ‰§è¡Œçº¿ç¨‹çš„æ ˆä¸­,å…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®è¿™ä¸ªæ ˆ.</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[çº¿ç¨‹é€šä¿¡]]></title>
        <id>https://www.sunjianbo.com/thread-communication/</id>
        <link href="https://www.sunjianbo.com/thread-communication/">
        </link>
        <updated>2020-08-07T04:13:43.000Z</updated>
        <content type="html"><![CDATA[<p>è¦æƒ³å®ç°å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„ååŒï¼Œå¦‚ï¼šçº¿ç¨‹æ‰§è¡Œå…ˆåé¡ºåºã€è·å–æŸä¸ªçº¿ç¨‹æ‰§è¡Œçš„ç»“æœç­‰ç­‰</p>
<p>æ¶‰åŠåˆ°çº¿ç¨‹ä¹‹é—´ç›¸äº’é€šä¿¡ï¼Œåˆ†ä¸ºä¸‹é¢å››ç±»</p>
<h2 id="æ–‡ä»¶å…±äº«">æ–‡ä»¶å…±äº«</h2>
<figure data-type="image" tabindex="1"><img src="https://static.sunjianbo.com/image-20200612091611411.png" alt="" loading="lazy"></figure>
<h2 id="ç½‘ç»œå…±äº«">ç½‘ç»œå…±äº«</h2>
<p>ç•¥</p>
<h2 id="å…±äº«å˜é‡">å…±äº«å˜é‡</h2>
<figure data-type="image" tabindex="2"><img src="https://static.sunjianbo.com/image-20200612091647383.png" alt="" loading="lazy"></figure>
<pre><code class="language-java">  // å…±äº«å˜é‡
  public static String content = &quot;ç©º&quot;;
  
  public static void main(String[] args) {
    // çº¿ç¨‹1 - å†™å…¥æ•°æ®
    new Thread(() -&gt; {
      try {
        while (true) {
          content = &quot;å½“å‰æ—¶é—´&quot; + String.valueOf(System.currentTimeMillis());
          Thread.sleep(1000L);
        }
      } catch (Exception e) {
        e.printStackTrace();
      }
    }).start();

    // çº¿ç¨‹2 - è¯»å–æ•°æ®
    new Thread(() -&gt; {
      try {
        while (true) {
          Thread.sleep(1000L);
          System.out.println(content);
        }
      } catch (Exception e) {
        e.printStackTrace();
      }
    }).start();
  }
</code></pre>
<h2 id="jdkæä¾›çš„çº¿ç¨‹åè°ƒapi">jdkæä¾›çš„çº¿ç¨‹åè°ƒAPI</h2>
<p>JDKä¸­å¯¹äºéœ€è¦å¤šçº¿ç¨‹åä½œå®ŒæˆæŸä¸€ä»»åŠ¡çš„åœºæ™¯ï¼Œæä¾›äº†å¯¹åº”APIæ”¯æŒã€‚</p>
<p>å¤šçº¿ç¨‹åä½œçš„å…¸å‹åœºæ™¯æ˜¯ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹(çº¿ç¨‹é˜»å¡ã€çº¿ç¨‹å”¤é†’)ã€‚</p>
<p>ç¤ºä¾‹ï¼šçº¿ç¨‹1å»ä¹°åŒ…å­ï¼Œæ²¡æœ‰åŒ…å­ï¼Œåˆ™ä¸å†æ‰§è¡Œã€‚çº¿ç¨‹2ç”Ÿäº§å‡ºåŒ…å­ï¼Œé€šçŸ¥çº¿ç¨‹-1ç»§ç»­æ‰§è¡Œã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://static.sunjianbo.com/image-20200612091856807.png" alt="" loading="lazy"></figure>
<h3 id="è¢«å¼ƒç”¨çš„suspendå’Œresume">è¢«å¼ƒç”¨çš„suspendå’Œresume</h3>
<p>ä½œç”¨:è°ƒç”¨suspendæŒ‚èµ·ç›®æ ‡çº¿ç¨‹,é€šè¿‡resumeå¯ä»¥æ¢å¤çº¿ç¨‹æ‰§è¡Œ</p>
<h4 id="æ­£å¸¸çš„suspendresume">æ­£å¸¸çš„suspend/resume</h4>
<pre><code class="language-java">/** åŒ…å­åº— */
public static Object baozidian = null;

/** æ­£å¸¸çš„suspend/resume */
public void suspendResumeTest() throws Exception {
	// å¯åŠ¨çº¿ç¨‹
	Thread consumerThread = new Thread(() -&gt; {
		while (baozidian == null) { // å¦‚æœæ²¡åŒ…å­ï¼Œåˆ™è¿›å…¥ç­‰å¾…
			System.out.println(&quot;1ã€è¿›å…¥ç­‰å¾…&quot;);
			Thread.currentThread().suspend();
		}
		System.out.println(&quot;2ã€ä¹°åˆ°åŒ…å­ï¼Œå›å®¶&quot;);
	});
	consumerThread.start();
	// 3ç§’ä¹‹åï¼Œç”Ÿäº§ä¸€ä¸ªåŒ…å­
	Thread.sleep(3000L);
	baozidian = new Object();
	consumerThread.resume();
	System.out.println(&quot;3ã€é€šçŸ¥æ¶ˆè´¹è€…&quot;);
}

</code></pre>
<h4 id="åŒæ­¥ä»£ç ä¸­ä½¿ç”¨å¯¼è‡´æ­»é”">åŒæ­¥ä»£ç ä¸­ä½¿ç”¨å¯¼è‡´æ­»é”</h4>
<pre><code class="language-java">/** æ­»é”çš„suspend/resumeã€‚ suspendå¹¶ä¸ä¼šåƒwaitä¸€æ ·é‡Šæ”¾é”ï¼Œæ•…æ­¤å®¹æ˜“å†™å‡ºæ­»é”ä»£ç  */
public void suspendResumeDeadLockTest() throws Exception {
	// å¯åŠ¨çº¿ç¨‹
	Thread consumerThread = new Thread(() -&gt; {
		if (baozidian == null) { // å¦‚æœæ²¡åŒ…å­ï¼Œåˆ™è¿›å…¥ç­‰å¾…
			System.out.println(&quot;1ã€è¿›å…¥ç­‰å¾…&quot;);
			// å½“å‰çº¿ç¨‹æ‹¿åˆ°é”ï¼Œç„¶åæŒ‚èµ·
			synchronized (this) {
				Thread.currentThread().suspend();
			}
		}
		System.out.println(&quot;2ã€ä¹°åˆ°åŒ…å­ï¼Œå›å®¶&quot;);
	});
	consumerThread.start();
	// 3ç§’ä¹‹åï¼Œç”Ÿäº§ä¸€ä¸ªåŒ…å­
	Thread.sleep(3000L);
	baozidian = new Object();
	// äº‰å–åˆ°é”ä»¥åï¼Œå†æ¢å¤consumerThread
	synchronized (this) {
		consumerThread.resume();
	}
	System.out.println(&quot;3ã€é€šçŸ¥æ¶ˆè´¹è€…&quot;);
}

</code></pre>
<h4 id="resumeæ¯”suspendå…ˆæ‰§è¡Œå¯¼è‡´æ­»é”">resumeæ¯”suspendå…ˆæ‰§è¡Œå¯¼è‡´æ­»é”</h4>
<pre><code class="language-java">/** å¯¼è‡´ç¨‹åºæ°¸ä¹…æŒ‚èµ·çš„suspend/resume */
public void suspendResumeDeadLockTest2() throws Exception {
	// å¯åŠ¨çº¿ç¨‹
	Thread consumerThread = new Thread(() -&gt; {
		if (baozidian == null) {
			System.out.println(&quot;1ã€æ²¡åŒ…å­ï¼Œè¿›å…¥ç­‰å¾…&quot;);
			try { // ä¸ºè¿™ä¸ªçº¿ç¨‹åŠ ä¸Šä¸€ç‚¹å»¶æ—¶
				Thread.sleep(5000L);
			} catch (InterruptedException e) {
				e.printStackTrace();
			}
			// è¿™é‡Œçš„æŒ‚èµ·æ‰§è¡Œåœ¨resumeåé¢
			Thread.currentThread().suspend();
		}
		System.out.println(&quot;2ã€ä¹°åˆ°åŒ…å­ï¼Œå›å®¶&quot;);
	});
	consumerThread.start();
	// 3ç§’ä¹‹åï¼Œç”Ÿäº§ä¸€ä¸ªåŒ…å­
	Thread.sleep(3000L);
	baozidian = new Object();
	consumerThread.resume();
	System.out.println(&quot;3ã€é€šçŸ¥æ¶ˆè´¹è€…&quot;);
	consumerThread.join();
}
</code></pre>
<h3 id="waitnotifyæœºåˆ¶">wait/notifyæœºåˆ¶</h3>
<p>åŸºäºç›‘è§†å™¨å®ç°,è¿™äº›æ–¹æ³•åªèƒ½ç”±<strong>åŒä¸€å¯¹è±¡é”çš„æŒæœ‰è€…çº¿ç¨‹</strong>è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯å†™åœ¨åŒæ­¥å—é‡Œé¢ï¼Œå¦åˆ™ä¼šæŠ›å‡ºIllegalMonitorStateExceptionå¼‚å¸¸</p>
<p><strong>wait</strong>æ–¹æ³•å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®å°±æ˜¯å°†çº¿ç¨‹åŠ å…¥åˆ°å¯¹è±¡çš„ç­‰å¾…é›†åˆä¸­ï¼Œå¹¶ä¸”æ”¾å¼ƒå½“å‰æŒæœ‰çš„å¯¹è±¡é”ã€‚</p>
<p><strong>notify/notifyall</strong>æ–¹æ³•å”¤é†’ä¸€ä¸ªæˆ–æ‰€æœ‰æ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡é”çš„çº¿ç¨‹ã€‚</p>
<p><strong>æ³¨æ„ï¼š<strong>è™½ç„¶ä¼šwaitè‡ªåŠ¨è§£é”ï¼Œä½†æ˜¯</strong>å¯¹é¡ºåºæœ‰è¦æ±‚</strong>ï¼Œå¦‚æœåœ¨ notifyè¢«è°ƒç”¨ä¹‹åï¼Œæ‰å¼€å§‹waitæ–¹æ³•çš„è°ƒç”¨ï¼Œçº¿ç¨‹ä¼šæ°¸è¿œå¤„äº WAITINGçŠ¶æ€ã€‚</p>
<h4 id="æ­£å¸¸çš„waitnotify">æ­£å¸¸çš„wait/notify</h4>
<pre><code class="language-java">/** æ­£å¸¸çš„wait/notify */
public void waitNotifyTest() throws Exception {
	// å¯åŠ¨çº¿ç¨‹
	new Thread(() -&gt; {
			synchronized (this) {
				while (baozidian == null) { // å¦‚æœæ²¡åŒ…å­ï¼Œåˆ™è¿›å…¥ç­‰å¾…
				try {
					System.out.println(&quot;1ã€è¿›å…¥ç­‰å¾…&quot;);
					this.wait();
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}
		}
		System.out.println(&quot;2ã€ä¹°åˆ°åŒ…å­ï¼Œå›å®¶&quot;);
	}).start();
	// 3ç§’ä¹‹åï¼Œç”Ÿäº§ä¸€ä¸ªåŒ…å­
	Thread.sleep(3000L);
	baozidian = new Object();
	synchronized (this) {
		this.notifyAll();
		System.out.println(&quot;3ã€é€šçŸ¥æ¶ˆè´¹è€…&quot;);
	}
}
</code></pre>
<h4 id="notifyæ¯”waitå…ˆæ‰§è¡Œå¯¼è‡´æ­»é”">notifyæ¯”waitå…ˆæ‰§è¡Œå¯¼è‡´æ­»é”</h4>
<pre><code class="language-java">/** ä¼šå¯¼è‡´ç¨‹åºæ°¸ä¹…ç­‰å¾…çš„wait/notify */
public void waitNotifyDeadLockTest() throws Exception {
	// å¯åŠ¨çº¿ç¨‹
	new Thread(() -&gt; {
		if (baozidian == null) { // å¦‚æœæ²¡åŒ…å­ï¼Œåˆ™è¿›å…¥ç­‰å¾…
			try {
				Thread.sleep(5000L);
			} catch (InterruptedException e1) {
				e1.printStackTrace();
			}
			synchronized (this) {
				try {
					System.out.println(&quot;1ã€è¿›å…¥ç­‰å¾…&quot;);
					this.wait();
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
			}
		}
		System.out.println(&quot;2ã€ä¹°åˆ°åŒ…å­ï¼Œå›å®¶&quot;);
	}).start();
	// 3ç§’ä¹‹åï¼Œç”Ÿäº§ä¸€ä¸ªåŒ…å­
	Thread.sleep(3000L);
	baozidian = new Object();
	synchronized (this) {
		this.notifyAll();
		System.out.println(&quot;3ã€é€šçŸ¥æ¶ˆè´¹è€…&quot;);
	}
}
</code></pre>
<h3 id="parkunparkæœºåˆ¶">park/unparkæœºåˆ¶</h3>
<p>çº¿ç¨‹è°ƒç”¨parkåˆ™ç­‰å¾…&quot;è®¸å¯(permit)&quot;.unparkæ–¹æ³•ä¸ºæŒ‡å®šçº¿ç¨‹æä¾›&quot;è®¸å¯&quot;</p>
<p>ä¸è¦æ±‚parkå’Œunparkæ–¹æ³•çš„è°ƒç”¨é¡ºåº</p>
<p>å¤šæ¬¡è°ƒç”¨unparkå,å†è°ƒç”¨park,çº¿ç¨‹ä¼šç›´æ¥è¿è¡Œ,ä½†<strong>è®¸å¯ä¸ä¼šå åŠ </strong>,</p>
<p>ä¹Ÿå°±æ˜¯è¯´,è¿ç»­å¤šæ¬¡è°ƒç”¨parkæ–¹æ³•,ç¬¬ä¸€æ¬¡ä¼šæ‹¿åˆ°&quot;è®¸å¯&quot;ç›´æ¥è¿è¡Œ,åç»­è°ƒç”¨ä¾æ—§ä¼šè¿›å…¥ç­‰å¾….</p>
<h4 id="æ­£å¸¸çš„parkunpark">æ­£å¸¸çš„park/unpark</h4>
<pre><code class="language-java">/** æ­£å¸¸çš„park/unpark */
public void parkUnparkTest() throws Exception {
	// å¯åŠ¨çº¿ç¨‹
	Thread consumerThread = new Thread(() -&gt; {
		while (baozidian == null) { // å¦‚æœæ²¡åŒ…å­ï¼Œåˆ™è¿›å…¥ç­‰å¾…
			System.out.println(&quot;1ã€è¿›å…¥ç­‰å¾…&quot;);
			LockSupport.park();
		}
		System.out.println(&quot;2ã€ä¹°åˆ°åŒ…å­ï¼Œå›å®¶&quot;);
	});
	consumerThread.start();
	// 3ç§’ä¹‹åï¼Œç”Ÿäº§ä¸€ä¸ªåŒ…å­
	Thread.sleep(3000L);
	baozidian = new Object();
	LockSupport.unpark(consumerThread);
	System.out.println(&quot;3ã€é€šçŸ¥æ¶ˆè´¹è€…&quot;);
}
</code></pre>
<h4 id="åŒæ­¥ä»£ç ä¸­ä½¿ç”¨å¯¼è‡´æ­»é”-2">åŒæ­¥ä»£ç ä¸­ä½¿ç”¨å¯¼è‡´æ­»é”</h4>
<pre><code class="language-java">/** æ­»é”çš„park/unpark */
public void parkUnparkDeadLockTest() throws Exception {
	// å¯åŠ¨çº¿ç¨‹
	Thread consumerThread = new Thread(() -&gt; {
		if (baozidian == null) { // å¦‚æœæ²¡åŒ…å­ï¼Œåˆ™è¿›å…¥ç­‰å¾…
			System.out.println(&quot;1ã€è¿›å…¥ç­‰å¾…&quot;);
			// å½“å‰çº¿ç¨‹æ‹¿åˆ°é”ï¼Œç„¶åæŒ‚èµ·
			synchronized (this) {
				LockSupport.park();
			}
		}
		System.out.println(&quot;2ã€ä¹°åˆ°åŒ…å­ï¼Œå›å®¶&quot;);
	});
	consumerThread.start();
	// 3ç§’ä¹‹åï¼Œç”Ÿäº§ä¸€ä¸ªåŒ…å­
	Thread.sleep(3000L);
	baozidian = new Object();
	// äº‰å–åˆ°é”ä»¥åï¼Œå†æ¢å¤consumerThread
	synchronized (this) {
		LockSupport.unpark(consumerThread);
	}
	System.out.println(&quot;3ã€é€šçŸ¥æ¶ˆè´¹è€…&quot;);
}
</code></pre>
<h3 id="ä¼ªå”¤é†’">ä¼ªå”¤é†’</h3>
<p><code>è­¦å‘Šï¼ä¹‹å‰ä»£ç ä¸­ç”¨ifè¯­å¥æ¥åˆ¤æ–­ï¼Œæ˜¯å¦è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ˜¯é”™è¯¯çš„ï¼</code>(ä¸Šæ–‡ä»£ç æ­£å¸¸çš„éƒ½æ˜¯ä½¿ç”¨çš„while)<br>
å®˜æ–¹å»ºè®®<code>åº”è¯¥åœ¨å¾ªç¯ä¸­æ£€æŸ¥ç­‰å¾…æ¡ä»¶</code>ï¼ŒåŸå› æ˜¯å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹å¯èƒ½ä¼šæ”¶åˆ°<code>é”™è¯¯è­¦æŠ¥å’Œä¼ªå”¤é†’</code>ï¼Œå¦‚æœä¸åœ¨å¾ªç¯ä¸­æ£€æŸ¥ç­‰å¾…æ¡ä»¶ï¼Œç¨‹åºå°±ä¼šåœ¨æ²¡æœ‰æ»¡è¶³ç»“æŸæ¡ä»¶çš„æƒ…å†µä¸‹é€€å‡ºã€‚</p>
<p>ä¼ªå”¤é†’æ˜¯æŒ‡çº¿ç¨‹å¹¶éå› ä¸ºnotify,notifyall,unparkç­‰apiè°ƒç”¨è€Œå”¤é†’,æ˜¯æ›´åº•å±‚åŸå› å¯¼è‡´çš„</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[CPUç¼“å­˜å’Œå†…å­˜å±éšœ]]></title>
        <id>https://www.sunjianbo.com/cpu-cache-and-memory-barrier/</id>
        <link href="https://www.sunjianbo.com/cpu-cache-and-memory-barrier/">
        </link>
        <updated>2020-08-06T03:40:13.000Z</updated>
        <content type="html"><![CDATA[<h2 id="cpuç¼“å­˜">CPUç¼“å­˜</h2>
<p>ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œçš„æ€§èƒ½,ç°ä»£CPUåœ¨å¾ˆå¤šæ–¹é¢å¯¹ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–.</p>
<p>ä¾‹å¦‚:CPUé«˜é€Ÿç¼“å­˜.å°½å¯èƒ½åœ°é¿å…å¤„ç†å™¨è®¿é—®ä¸»å†…å­˜çš„æ—¶é—´å¼€é”€,å¤„ç†å™¨å¤§å¤šä¼šåˆ©ç”¨ç¼“å­˜(Cache)ä»¥æé«˜æ€§èƒ½.</p>
<h3 id="å¤šçº§ç¼“å­˜">å¤šçº§ç¼“å­˜</h3>
<h4 id="l1-cacheä¸€çº§ç¼“å­˜">L1 Cache(ä¸€çº§ç¼“å­˜)</h4>
<p>CPUç¬¬ä¸€å±‚é«˜é€Ÿç¼“å­˜,åˆ†ä¸ºæ•°æ®ç¼“å­˜å’ŒæŒ‡ä»¤ç¼“å­˜.ä¸€èˆ¬æœåŠ¡å™¨CPUçš„L1ç¼“å­˜çš„å®¹é‡åœ¨32---4096KB</p>
<h4 id="l2-cache">L2 Cache</h4>
<p>ç”±äºL1çº§é«˜é€Ÿç¼“å­˜å®¹é‡çš„é™åˆ¶,ä¸ºäº†å†æ¬¡æé«˜CPUçš„è¿ç®—é€Ÿåº¦,åœ¨CPUå¤–éƒ¨æ”¾ç½®ä¸€é«˜é€Ÿå­˜å‚¨å™¨,å³äºŒçº§ç¼“å­˜</p>
<h4 id="l3-cache">L3 Cache</h4>
<p>ç°åœ¨éƒ½æ˜¯å†…ç½®çš„,L3ç¼“å­˜çš„åº”ç”¨å¯ä»¥è¿›ä¸€æ­¥é™ä½å†…å­˜å»¶è¿Ÿ,åŒæ—¶æå‡å¤§æ•°æ®é‡è®¡ç®—æ—¶å¤„ç†å™¨çš„æ€§èƒ½.å…·æœ‰è¾ƒå¤§L3ç¼“å­˜çš„å¤„ç†å™¨èƒ½æä¾›æ›´æœ‰æ•ˆçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜è¡Œä¸ºåŠè¾ƒçŸ­æ¶ˆæ¯å’Œå¤„ç†å™¨é˜Ÿåˆ—é•¿åº¦.ä¸€èˆ¬æ˜¯å¤šæ ¸å…±äº«ä¸€ä¸ªL3ç¼“å­˜</p>
<p>CPUåœ¨è¯»å–æ•°æ®æ—¶,å…ˆåœ¨L1ä¸­å¯»æ‰¾,å†ä»L2å¯»æ‰¾,å†ä»L3å¯»æ‰¾,ç„¶åæ˜¯å†…å­˜,å†åæ˜¯å¤–å­˜å‚¨å™¨(ç¡¬ç›˜ç­‰)</p>
<h3 id="ç¼“å­˜åŒæ­¥åè®®">ç¼“å­˜åŒæ­¥åè®®</h3>
<p>å¤šCPUè¯»å–åŒæ ·çš„æ•°æ®è¿›è¡Œç¼“å­˜,è¿›è¡Œä¸åŒè¿ç®—ä¹‹å,æœ€ç»ˆå†™å…¥ä¸»å†…å­˜ä»¥å“ªä¸ªCPUä¸ºå‡†?</p>
<p>åœ¨è¿™ç§é«˜é€Ÿç¼“å­˜å›å†™çš„åœºæ™¯ä¸‹ï¼Œæœ‰ä¸€ä¸ªç¼“å­˜ä¸€è‡´æ€§åè®®å¤šæ•°CPUå‚å•†å¯¹å®ƒè¿›è¡Œäº†å®ç°ã€‚</p>
<p><strong>MESIåè®®</strong>ï¼Œå®ƒè§„å®šæ¯æ¡ç¼“å­˜æœ‰ä¸ªçŠ¶æ€ä½ï¼ŒåŒæ—¶å®šä¹‰äº†ä¸‹é¢å››ä¸ªçŠ¶æ€:</p>
<ul>
<li>
<p>**ä¿®æ”¹æ€ï¼ˆ Modifiedï¼‰ğŸ˜—*æ­¤ cacheè¡Œå·²è¢«ä¿®æ”¹è¿‡ï¼ˆè„è¡Œï¼‰ï¼Œå†…å®¹å·²ä¸åŒäºä¸»å­˜ï¼Œä¸ºæ­¤ cacheä¸“æœ‰ï¼›</p>
</li>
<li>
<p>**ä¸“æœ‰æ€ï¼ˆ Exclusiveï¼‰ğŸ˜—*æ­¤ cacheè¡Œå†…å®¹åŒäºä¸»å­˜ï¼Œä½†ä¸å‡ºç°äºå…¶å®ƒ cacheä¸­ï¼›</p>
</li>
<li>
<p>**å…±äº«æ€ï¼ˆ Sharedï¼‰ğŸ˜—*æ­¤ cacheè¡Œå†…å®¹åŒäºä¸»å­˜ï¼Œä½†ä¹Ÿå‡ºç°äºå…¶å®ƒ cacherä¸­ï¼›</p>
</li>
<li>
<p>**æ— æ•ˆæ€ï¼ˆ Invalidï¼‰ğŸ˜—*æ­¤ cacheï¼Ÿè¡Œå†…å®¹æ— æ•ˆï¼ˆç©ºè¡Œï¼‰ã€‚</p>
</li>
</ul>
<p>å¤šå¤„ç†å™¨æ—¶ï¼Œå•ä¸ªCPUå¯¹ç¼“å­˜ä¸­æ•°æ®è¿›è¡Œäº†æ”¹åŠ¨ï¼Œéœ€è¦é€šçŸ¥ç»™å…¶ä»–CPU.</p>
<p>ä¹Ÿå°±æ˜¯æ„å‘³ç€ï¼ŒCPUå¤„ç†è¦æ§åˆ¶è‡ªå·±çš„è¯»å†™æ“ä½œï¼Œè¿˜è¦<strong>ç›‘å¬</strong>å…¶ä»–CPUå‘å‡ºçš„é€šçŸ¥ï¼Œä»è€Œä¿è¯<strong>æœ€ç»ˆä¸€è‡´</strong></p>
<h2 id="cpuæŒ‡ä»¤é‡æ’">CPUæŒ‡ä»¤é‡æ’</h2>
<h3 id="å®ä¾‹">å®ä¾‹</h3>
<pre><code class="language-java">//ä»£ç 
x=100;
y=z;
</code></pre>
<p>æ­£å¸¸æ‰§è¡Œçš„ä¸‰æ­¥éª¤</p>
<blockquote>
<p>1ã€å°†100å†™å…¥X<br>
2ã€è¯»å–zçš„å€¼<br>
3ã€å°†zå€¼å†™å…¥y</p>
</blockquote>
<p>é‡æ’åºåæ‰§è¡Œ</p>
<blockquote>
<p>1ã€è¯»å–zçš„å€¼<br>
2ã€å°†zå€¼å†™å…¥y<br>
3ã€å°†100å†™å…¥X</p>
</blockquote>
<h3 id="æŒ‡ä»¤é‡æ’çš„åœºæ™¯">æŒ‡ä»¤é‡æ’çš„åœºæ™¯</h3>
<p>å½“CPUå†™ç¼“å­˜æ—¶å‘ç°ç¼“å­˜åŒºå—æ­£è¢«å…¶ä»–CPUå ç”¨ï¼Œä¸ºäº†æé«˜CPUå¤„ç†æ€§èƒ½ï¼Œå¯èƒ½å°†åé¢çš„è¯»ç¼“å­˜å‘½ä»¤ä¼˜å…ˆæ‰§è¡Œã€‚</p>
<h3 id="as-if-serial">as-if- serial</h3>
<p>å¹¶ééšä¾¿é‡æ’ï¼Œéœ€è¦éµå®ˆas-if- serialè¯­ä¹‰</p>
<p>as-if- serialè¯­ä¹‰çš„æ„æ€æŒ‡ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚</p>
<p>ç¼–è¯‘å™¨ï¼Œ runtimeå’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆas-if- serialè¯­ä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºã€‚</p>
<h2 id="ä¸¤ä¸ªé—®é¢˜">ä¸¤ä¸ªé—®é¢˜</h2>
<h3 id="cpué«˜é€Ÿç¼“å­˜ä¸‹çš„é—®é¢˜">CPUé«˜é€Ÿç¼“å­˜ä¸‹çš„é—®é¢˜</h3>
<p>ç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸»å†…å­˜çš„æ•°æ®å¹¶ä¸æ˜¯å®æ—¶åŒæ­¥çš„ï¼Œå„CPUï¼ˆæˆ–CPUæ ¸å¿ƒï¼‰é—´ç¼“å­˜çš„æ•°æ®ä¹Ÿä¸æ˜¯å®æ—¶åŒæ­¥ã€‚<strong>åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œå„CPUæ‰€çœ‹åˆ°åŒä¸€å†…å­˜åœ°å€çš„æ•°æ®çš„å€¼å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚</strong></p>
<h3 id="cpuæ‰§è¡ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–ä¸‹çš„é—®é¢˜">CPUæ‰§è¡ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–ä¸‹çš„é—®é¢˜</h3>
<p>è™½ç„¶éµå®ˆäº†as- if-serialiè¯­ä¹‰ï¼Œå•ä»…åœ¨<strong>å•CPU</strong>è‡ªå·±æ‰§è¡Œçš„æƒ…å†µä¸‹<strong>èƒ½ä¿è¯ç»“æœæ­£ç¡®</strong>ã€‚<br>
<strong>å¤šæ ¸å¤šçº¿ç¨‹ä¸­ï¼ŒæŒ‡ä»¤é€»è¾‘æ— æ³•åˆ†è¾¨å› æœå…³è”ï¼Œå¯èƒ½å‡ºç°ä¹±åºæ‰§è¡Œï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œç»“æœé”™è¯¯ã€‚</strong></p>
<h2 id="å†…å­˜å±éšœ">å†…å­˜å±éšœ</h2>
<p>ä¸ºäº†è§£æ±ºä¸Šè¿°ä¸¤ä¸ªé—®é¢˜,å¤„ç†å™¨æä¾›äº†ä¸¤ä¸ªå†…å­˜å±éšœæŒ‡ä»¤ï¼ˆ Memory Barrierï¼‰</p>
<h3 id="å†™å†…å­˜å±éšœ-store-memory-barrier">å†™å†…å­˜å±éšœï¼ˆ Store Memory Barrier)</h3>
<p>åœ¨æŒ‡ä»¤åæ’å…¥ Store Barrierï¼Œèƒ½è®©å†™å…¥ç¼“å­˜ä¸­çš„æœ€æ–°æ•°æ®æ›´æ–°å†™å…¥ä¸»å†…å­˜ï¼Œè®©å…¶ä»–çº¿ç¨‹å¯è§ã€‚<br>
å¼ºåˆ¶å†™å…¥ä¸»å†…å­˜ï¼Œè¿™ç§æ˜¾ç¤ºè°ƒç”¨ï¼ŒCPUå°±ä¸ä¼šå› ä¸ºæ€§èƒ½è€ƒè™‘è€Œå»å¯¹æŒ‡ä»¤é‡æ’ã€‚</p>
<h3 id="è¯»å†…å­˜å±éšœ-load-memory-barrier">è¯»å†…å­˜å±éšœï¼ˆ Load Memory Barrier.)</h3>
<p>åœ¨æŒ‡ä»¤å‰æ’å…¥ Load Barrierï¼Œå¯ä»¥è®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œå¼ºåˆ¶ä»æ–°ä»ä¸»å†…å­˜åŠ è½½æ•°æ®ã€‚<br>
å¼ºåˆ¶è¯»å–ä¸»å†…å­˜å†…å®¹ï¼Œè®©CPUç¼“å­˜ä¸ä¸»å†…å­˜ä¿æŒä¸€è‡´ï¼Œé¿å…äº†ç¼“å­˜å¯¼è‡´çš„ä¸€è‡´æ€§é—®é¢˜</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>è¿™ä¸ªç« èŠ‚æ˜¯åé¢<strong>JVMçº¿ç¨‹å®‰å…¨é—®é¢˜çš„é“ºå«</strong>ã€‚<br>
åŒæ—¶ï¼Œä¹Ÿçœ‹åˆ°äº†ç°ä»£CPUä¸æ–­æ¼”è¿›ï¼Œåœ¨ç¨‹åºè¿è¡Œä¼˜åŒ–ä¸­åšå‡ºçš„åŠªåŠ›ã€‚ä¸åŒCPUå‚å•†æ‰€ä»˜å‡ºçš„äººåŠ›ç‰©åŠ›æˆæœ¬ï¼Œæœ€ç»ˆä½“ç°åœ¨ä¸åŒCPUæ€§èƒ½å·®è·ä¸Šã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[clash for windowså‡çº§åå‘ç°socksç«¯å£åˆå¹¶åˆ°7890äº†]]></title>
        <id>https://www.sunjianbo.com/clash-for-windows-socks-port-7890/</id>
        <link href="https://www.sunjianbo.com/clash-for-windows-socks-port-7890/">
        </link>
        <updated>2020-07-24T01:19:11.000Z</updated>
        <content type="html"><![CDATA[<p>æ˜¨å¤©æ‰‹è´±æ›´æ–°äº†ä¸€ä¸‹è®¢é˜…,ç»“æœä¸èƒ½ç”¨äº†,ä¼°è®¡æ˜¯è§„åˆ™è¿›è¡Œäº†æ›´æ–°,æ²¡åŠæ³•åªå¥½å‡çº§clash.</p>
<p>æ–°ç‰ˆclashé¡µé¢å¤§æ”¹</p>
<p>å‡çº§å®Œä¹‹åchromeæ€ä¹ˆéƒ½ä¸Šä¸å»,åæ¥ä»”ç»†ä¸€çœ‹å‘ç°æœ€æ–°ç‰ˆ0.11.1åªå†™äº†ä¸€ä¸ªç«¯å£7890</p>
<p>æŸ¥çœ‹å‘å¸ƒæ—¥å¿—å‘ç°åœ¨0.10.2ç‰ˆæœ¬çš„æ—¶å€™å°†ç«¯å£è¿›è¡Œäº†åˆå¹¶</p>
<blockquote>
<p>migrate to mixed-port from port and socks-port</p>
</blockquote>
<p>è™½è¯´ä¸€ä¸ªç«¯å£æ··åˆäº†httpå’Œsocksç”¨èµ·æ¥ç¡®å®æ–¹ä¾¿äº†,ä½†æ˜¯æˆ‘è¿™æ ·çš„è€ç”¨æˆ·è¿˜çœŸæ˜¯æœ‰ç‚¹éº»çƒ¦äº†,é¦–å…ˆè¦æ”¹æµè§ˆå™¨æ’ä»¶SwitchyOmegaé‡Œé¢çš„ç«¯å£,ç„¶åè¿˜è¦æ”¹Proxifieré‡Œé¢çš„ç«¯å£.</p>
<p>å…³é”®æ˜¯è¦æ˜¯æ²¡æ³¨æ„åˆ°ç«¯å£å˜åŒ–çš„äººè¿˜çœŸæ˜¯è¦æµªè´¹å¾ˆå¤šçš„æ—¶é—´æ¥æ’æŸ¥é—®é¢˜.</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[çº¿ç¨‹ä¸­æ­¢]]></title>
        <id>https://www.sunjianbo.com/thread-abort/</id>
        <link href="https://www.sunjianbo.com/thread-abort/">
        </link>
        <updated>2020-07-17T06:49:17.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ä¸æ¨èçš„ä¸­æ­¢æ–¹å¼">ä¸æ¨èçš„ä¸­æ­¢æ–¹å¼</h2>
<h3 id="stop">stop</h3>
<blockquote>
<p>ä¸­æ­¢çº¿ç¨‹,å¹¶ä¸”æ¸…é™¤ç›‘æ§å™¨é”çš„ä¿¡æ¯,å¯èƒ½å¯¼è‡´çº¿ç¨‹å®‰å…¨æ–‡ä»¶,jdkä¸å»ºè®®ä½¿ç”¨</p>
</blockquote>
<p>ä¸¾ä¾‹è¯´æ˜å¦‚ä½•å¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜:</p>
<p>å…ˆå®šä¹‰ä¸€ä¸ªçº¿ç¨‹,å®ç°iå’ŒjåŒæ—¶+1</p>
<pre><code class="language-java">public class StopThread extends Thread {
  private int i = 0, j = 0;

  @Override
  public void run() {
    synchronized (this) {
	    // å¢åŠ åŒæ­¥é”ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨
	    ++i;
	    try {
	      // ä¼‘çœ 10ç§’,æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
	      Thread.sleep(10000);
	    } catch (InterruptedException e) {
	      e.printStackTrace();
	    }
	    ++j;
    }
  }

  /** * æ‰“å°iå’Œj */
  public void print() {
  System.out.println(&quot;i=&quot; + i + &quot; j=&quot; + j);
  }
}
</code></pre>
<p>stopæ–¹å¼ä¸­æ­¢</p>
<pre><code class="language-java">/**
 * ç¤ºä¾‹3 - çº¿ç¨‹stopå¼ºåˆ¶æ€§ä¸­æ­¢ï¼Œç ´åçº¿ç¨‹å®‰å…¨çš„ç¤ºä¾‹
 */
public class Demo31 {
  public static void main(String[] args) throws InterruptedException {
    StopThread thread = new StopThread();
    thread.start();
    // ä¼‘çœ 1ç§’ï¼Œç¡®ä¿iå˜é‡è‡ªå¢æˆåŠŸ
    Thread.sleep(1000);
    // æš‚åœçº¿ç¨‹
    thread.stop(); // é”™è¯¯çš„ç»ˆæ­¢
    // thread.interrupt(); // æ­£ç¡®ç»ˆæ­¢
    while (thread.isAlive()) {
      // ç¡®ä¿çº¿ç¨‹å·²ç»ç»ˆæ­¢
    } // è¾“å‡ºç»“æœ
    thread.print();
  }
}

</code></pre>
<p>ç†æƒ³è¾“å‡º:i=0 j=0</p>
<p>å®é™…æ‰§è¡Œç»“æœ:i=1 j=0</p>
<p>iæ²¡æœ‰å› ä¸­æ­¢è€Œå›æ»š,æ²¡æœ‰ä¿è¯åŒæ­¥ä»£ç å—é‡Œé¢çš„æ•°æ®ä¸€è‡´æ€§,ç ´åäº†çº¿ç¨‹å®‰å…¨</p>
<h3 id="destroy">destroy</h3>
<blockquote>
<p>jdkæœªå®ç°è¯¥æ–¹æ³•</p>
</blockquote>
<h2 id="ä¼˜é›…çš„çº¿ç¨‹ä¸­æ­¢">ä¼˜é›…çš„çº¿ç¨‹ä¸­æ­¢</h2>
<h3 id="interrupt">interrupt</h3>
<ul>
<li>
<p>å¦‚æœç›®æ ‡çº¿ç¨‹åœ¨è°ƒç”¨Object classçš„<code>wait()</code>,<code>wait(long)</code>,<code>wait(long,int)</code>æ–¹æ³•,<code>join()</code>,<code>join(long,int)</code>æˆ–<code>sleep(long,int)</code>æ–¹æ³•æ—¶è¢«é˜»å¡,é‚£ä¹ˆinterruptä¼šç”Ÿæ•ˆ,è¯¥çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€å°†è¢«æ¸…é™¤,æŠ›å‡ºInterruptedExceptionå¼‚å¸¸</p>
</li>
<li>
<p>å¦‚æœç›®æ ‡çº¿ç¨‹æ˜¯è¢«I/Oæˆ–è€…NIOä¸­çš„Channelæ‰€é˜»å¡,åŒæ ·,I/Oæ“ä½œä¼šè¢«ä¸­æ–­æˆ–è€…è¿”å›ç‰¹æ®Šå¼‚å¸¸å€¼.è¾¾åˆ°ç»ˆæ­¢çº¿ç¨‹çš„ç›®çš„.</p>
</li>
<li>
<p>å¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³,åˆ™ä¼šè®¾ç½®æ­¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€.</p>
</li>
</ul>
<p>å¤ç”¨ä¸Šé¢çš„ä¾‹å­,å°†å…¶ä¸­çš„<code>thread.stop();</code>æ”¹ä¸º<code>thread.interrupt();</code>æŸ¥çœ‹æ‰§è¡Œç»“æœ:</p>
<figure data-type="image" tabindex="1"><img src="https://static.sunjianbo.com/image-20200611104339183.png" alt="" loading="lazy"></figure>
<p>ç»“æœi=1 j=1ä¿è¯äº†æ•°æ®ä¸€è‡´æ€§,åŒæ—¶æŠ›å‡ºä¸€ä¸ªInterruptedExceptionå¼‚å¸¸æ¥ç»™å¼€å‘è€…è¿›è¡Œå¯¹åº”å¤„ç†</p>
<h3 id="æ ‡å¿—ä½">æ ‡å¿—ä½</h3>
<p>ä»£ç é€»è¾‘ä¸­,å¢åŠ ä¸€ä¸ªåˆ¤æ–­,ç”¨æ¥æ§åˆ¶çº¿ç¨‹çš„ä¸­æ­¢.</p>
<p>å¦‚ä¸‹ç¤ºä¾‹,è®¾ç½®ä¸€ä¸ªflag,é€šè¿‡å¤–éƒ¨ä¿®æ”¹flagçš„å€¼æ¥è®©whileæ¡ä»¶ä¸æ»¡è¶³è·³å‡ºå¾ªç¯ä»¥ä½¿çº¿ç¨‹ç»§ç»­è¿è¡Œåˆ°ç»“æŸ:</p>
<pre><code class="language-java">/** é€šè¿‡çŠ¶æ€ä½æ¥åˆ¤æ–­ */
public class Demo4 extends Thread {
  public volatile static boolean flag = true;

  public static void main(String[] args) throws InterruptedException {
    new Thread(() -&gt; {
      try {
        while (flag) { // åˆ¤æ–­æ˜¯å¦è¿è¡Œ
          System.out.println(&quot;è¿è¡Œä¸­&quot;);
          Thread.sleep(1000L);
        }
      } catch (InterruptedException e) {
        e.printStackTrace();
      }
    }).start();
    // 3ç§’ä¹‹åï¼Œå°†çŠ¶æ€æ ‡å¿—æ”¹ä¸ºFalseï¼Œä»£è¡¨ä¸ç»§ç»­è¿è¡Œ
    Thread.sleep(3000L);
    flag = false;
    System.out.println(&quot;ç¨‹åºè¿è¡Œç»“æŸ&quot;);
  }
}

</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[çº¿ç¨‹çŠ¶æ€]]></title>
        <id>https://www.sunjianbo.com/thread-state/</id>
        <link href="https://www.sunjianbo.com/thread-state/">
        </link>
        <updated>2020-07-03T01:47:48.000Z</updated>
        <content type="html"><![CDATA[<p>çº¿ç¨‹æœ‰6ä¸ªçŠ¶æ€,å¯ä»¥æŸ¥çœ‹java.lang.Thread.State</p>
<table>
<thead>
<tr>
<th>çŠ¶æ€</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>New</td>
<td>å°šæœªå¯åŠ¨çš„çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€</td>
</tr>
<tr>
<td>Runnable</td>
<td>å¯è¿è¡Œçº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€,ç­‰å¾…CPUè°ƒåº¦</td>
</tr>
<tr>
<td>Blocked</td>
<td>çº¿ç¨‹é˜»å¡ç­‰å¾…ç›‘è§†å™¨é”å®šçš„çº¿ç¨‹çŠ¶æ€</td>
</tr>
<tr>
<td>Waiting</td>
<td>ç­‰å¾…çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€.ä¸‹åˆ—ä¸å¸¦è¶…æ—¶çš„æ–¹å¼:<code>Object.wait</code>,<code>Thread.join</code>,<code>LockSupport.park</code></td>
</tr>
<tr>
<td>Timed Waiting</td>
<td>å…·æœ‰åˆ¶å®šç­‰å¾…æ—¶é—´çš„ç­‰å¾…çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€.ä¸‹åˆ—å¸¦è¶…æ—¶çš„æ–¹å¼:<code>Thread.sleep</code>,<code>Object.wait</code>,<code>Thread.join</code>,<code>LockSupport.parkNanos</code>,<code>LockSupport.parkUntil</code></td>
</tr>
<tr>
<td>Terminated</td>
<td>ç»ˆæ­¢çº¿ç¨‹çš„çº¿ç¨‹çŠ¶æ€,çº¿ç¨‹æ­£å¸¸å®Œæˆæ‰§è¡Œæˆ–è€…å‡ºç°å¼‚å¸¸</td>
</tr>
</tbody>
</table>
<figure data-type="image" tabindex="1"><img src="https://static.sunjianbo.com/image-20200611094432936.png" alt="states" loading="lazy"></figure>
<pre><code class="language-java">/**
 * å¤šçº¿ç¨‹è¿è¡ŒçŠ¶æ€åˆ‡æ¢ç¤ºä¾‹ &lt;br/&gt;
 */
public class Demo2 {
	public static Thread thread1;
	public static Demo2 obj;

	public static void main(String[] args) throws Exception {
		// ç¬¬ä¸€ç§çŠ¶æ€åˆ‡æ¢ - æ–°å»º -&gt; è¿è¡Œ -&gt; ç»ˆæ­¢
		System.out.println(&quot;#######ç¬¬ä¸€ç§çŠ¶æ€åˆ‡æ¢  - æ–°å»º -&gt; è¿è¡Œ -&gt; ç»ˆæ­¢################################&quot;);
		Thread thread1 = new Thread(new Runnable() {
			@Override
			public void run() {
				System.out.println(&quot;thread1å½“å‰çŠ¶æ€ï¼š&quot; + Thread.currentThread().getState().toString());
				System.out.println(&quot;thread1 æ‰§è¡Œäº†&quot;);
			}
		});
		System.out.println(&quot;æ²¡è°ƒç”¨startæ–¹æ³•ï¼Œthread1å½“å‰çŠ¶æ€ï¼š&quot; + thread1.getState().toString());
		thread1.start();
		Thread.sleep(2000L); // ç­‰å¾…thread1æ‰§è¡Œç»“æŸï¼Œå†çœ‹çŠ¶æ€
		System.out.println(&quot;ç­‰å¾…ä¸¤ç§’ï¼Œå†çœ‹thread1å½“å‰çŠ¶æ€ï¼š&quot; + thread1.getState().toString());
		// thread1.start(); TODO æ³¨æ„ï¼Œçº¿ç¨‹ç»ˆæ­¢ä¹‹åï¼Œå†è¿›è¡Œè°ƒç”¨ï¼Œä¼šæŠ›å‡ºIllegalThreadStateExceptionå¼‚å¸¸

		System.out.println();
		System.out.println(&quot;############ç¬¬äºŒç§ï¼šæ–°å»º -&gt; è¿è¡Œ -&gt; ç­‰å¾… -&gt; è¿è¡Œ -&gt; ç»ˆæ­¢(sleepæ–¹å¼)###########################&quot;);
		Thread thread2 = new Thread(new Runnable() {
			@Override
			public void run() {
				try {// å°†çº¿ç¨‹2ç§»åŠ¨åˆ°ç­‰å¾…çŠ¶æ€ï¼Œ1500åè‡ªåŠ¨å”¤é†’
					Thread.sleep(1500);
				} catch (InterruptedException e) {
					e.printStackTrace();
				}
				System.out.println(&quot;thread2å½“å‰çŠ¶æ€ï¼š&quot; + Thread.currentThread().getState().toString());
				System.out.println(&quot;thread2 æ‰§è¡Œäº†&quot;);
			}
		});
		System.out.println(&quot;æ²¡è°ƒç”¨startæ–¹æ³•ï¼Œthread2å½“å‰çŠ¶æ€ï¼š&quot; + thread2.getState().toString());
		thread2.start();
		System.out.println(&quot;è°ƒç”¨startæ–¹æ³•ï¼Œthread2å½“å‰çŠ¶æ€ï¼š&quot; + thread2.getState().toString());
		Thread.sleep(200L); // ç­‰å¾…200æ¯«ç§’ï¼Œå†çœ‹çŠ¶æ€
		System.out.println(&quot;ç­‰å¾…200æ¯«ç§’ï¼Œå†çœ‹thread2å½“å‰çŠ¶æ€ï¼š&quot; + thread2.getState().toString());
		Thread.sleep(3000L); // å†ç­‰å¾…3ç§’ï¼Œè®©thread2æ‰§è¡Œå®Œæ¯•ï¼Œå†çœ‹çŠ¶æ€
		System.out.println(&quot;ç­‰å¾…3ç§’ï¼Œå†çœ‹thread2å½“å‰çŠ¶æ€ï¼š&quot; + thread2.getState().toString());

		System.out.println();
		System.out.println(&quot;############ç¬¬ä¸‰ç§ï¼šæ–°å»º -&gt; è¿è¡Œ -&gt; é˜»å¡ -&gt; è¿è¡Œ -&gt; ç»ˆæ­¢###########################&quot;);
		Thread thread3 = new Thread(new Runnable() {
			@Override
			public void run() {
				synchronized (Demo2.class) {
					System.out.println(&quot;thread3å½“å‰çŠ¶æ€ï¼š&quot; + Thread.currentThread().getState().toString());
					System.out.println(&quot;thread3 æ‰§è¡Œäº†&quot;);
				}
			}
		});
		synchronized (Demo2.class) {
			System.out.println(&quot;æ²¡è°ƒç”¨startæ–¹æ³•ï¼Œthread3å½“å‰çŠ¶æ€ï¼š&quot; + thread3.getState().toString());
			thread3.start();
			System.out.println(&quot;è°ƒç”¨startæ–¹æ³•ï¼Œthread3å½“å‰çŠ¶æ€ï¼š&quot; + thread3.getState().toString());
			Thread.sleep(200L); // ç­‰å¾…200æ¯«ç§’ï¼Œå†çœ‹çŠ¶æ€
			System.out.println(&quot;ç­‰å¾…200æ¯«ç§’ï¼Œå†çœ‹thread3å½“å‰çŠ¶æ€ï¼š&quot; + thread3.getState().toString());
		}
		Thread.sleep(3000L); // å†ç­‰å¾…3ç§’ï¼Œè®©thread3æ‰§è¡Œå®Œæ¯•ï¼Œå†çœ‹çŠ¶æ€
		System.out.println(&quot;ç­‰å¾…3ç§’ï¼Œè®©thread3æŠ¢åˆ°é”ï¼Œå†çœ‹thread3å½“å‰çŠ¶æ€ï¼š&quot; + thread2.getState().toString());

	}
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[JAVAç¨‹åºè¿è¡ŒåŸç†åˆ†æ]]></title>
        <id>https://www.sunjianbo.com/jvm-operation-principle/</id>
        <link href="https://www.sunjianbo.com/jvm-operation-principle/">
        </link>
        <updated>2020-07-02T03:08:07.000Z</updated>
        <content type="html"><![CDATA[<p>æˆ‘çš„ç†è§£JVMå†…å­˜ç»“æ„å°±æ˜¯ç¨‹åºç”±å­—èŠ‚ç æ–‡ä»¶è¯»å…¥åˆ°jvmä¸­è§£æå­˜å‚¨åˆ°æ‰§è¡Œæ‰€éœ€è¦çš„ä¸€äº›ä¸œè¥¿</p>
<h2 id="classæ–‡ä»¶å†…å®¹">classæ–‡ä»¶å†…å®¹</h2>
<p>classæ–‡ä»¶åŒ…å«JAVAç¨‹åºæ‰§è¡Œçš„å­—èŠ‚ç ;æ•°æ®ä¸¥æ ¼æŒ‰ç…§æ ¼å¼ç´§å‡‘æ’åˆ—åœ¨classæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æµ,ä¸­é—´æ— ä»»ä½•åˆ†éš”ç¬¦;æ–‡ä»¶å¼€å¤´æœ‰ä¸€ä¸ª0xcafebabe(16è¿›åˆ¶)ç‰¹æ®Šçš„ä¸€ä¸ªæ ‡å¿—.</p>
<figure data-type="image" tabindex="1"><img src="https://static.sunjianbo.com/image-20200610134740885.png" alt="class" loading="lazy"></figure>
<p>classæ–‡ä»¶å†…å­˜å‚¨çš„æ˜¯æŒ‡ä»¤ç </p>
<h2 id="jvmè¿è¡Œæ—¶æ•°æ®åŒº">JVMè¿è¡Œæ—¶æ•°æ®åŒº</h2>
<figure data-type="image" tabindex="2"><img src="https://static.sunjianbo.com/image-20200610141943161.png" alt="jvm" loading="lazy"></figure>
<h3 id="çº¿ç¨‹å…±äº«">çº¿ç¨‹å…±äº«</h3>
<h4 id="æ–¹æ³•åŒº">æ–¹æ³•åŒº</h4>
<p>jvmç”¨æ¥å­˜å‚¨åŠ è½½çš„ç±»ä¿¡æ¯,å¸¸é‡,é™æ€å˜é‡,ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®.</p>
<p>è¿™æ˜¯è™šæ‹Ÿæœºä¸­çš„ä¸€ä¸ªé€»è¾‘åŒºåˆ’,å…·ä½“å®ç°æ ¹æ®ä¸åŒè™šæ‹Ÿæœºæ¥å®ç°.</p>
<p>å¦‚:oracleçš„HotSpotåœ¨java7ä¸­æ–¹æ³•åŒºæ”¾åœ¨æ°¸ä¹…ä»£,java8æ”¾åœ¨å…ƒæ•°æ®ç©ºé—´,å¹¶ä¸”é€šè¿‡GCæœºåˆ¶å¯¹è¿™ä¸ªåŒºåŸŸè¿›è¡Œç®¡ç†</p>
<h4 id="å †å†…å­˜">å †å†…å­˜</h4>
<p>å †å†…å­˜æ˜¯VMå¯åŠ¨æ—¶åˆ›å»º,ç”¨äºå­˜æ”¾å¯¹è±¡çš„å®ä¾‹.</p>
<p>è¿˜å¯ä»¥ç»†åˆ†ä¸º:è€å¹´ä»£,æ–°ç”Ÿä»£(Eden,From Survivor,To Survivor).</p>
<p>åƒåœ¾å›æ”¶å™¨ä¸»è¦å°±æ˜¯ç®¡ç†å †å†…å­˜.</p>
<p>å¦‚æœæ»¡äº†,å°±ä¼šå‡ºç°OutOfMemoryError</p>
<h2 id="çº¿ç¨‹ç‹¬äº«">çº¿ç¨‹ç‹¬äº«</h2>
<h4 id="è™šæ‹Ÿæœºæ ˆ">è™šæ‹Ÿæœºæ ˆ</h4>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç©ºé—´åˆä¸€ä¸ªç§æœ‰çš„ç©ºé—´.</p>
<p>çº¿ç¨‹æ ˆç”±å¤šä¸ªæ ˆå¸§ç»„æˆ.</p>
<p>ä¸€ä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•,ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªæ ˆå¸§.</p>
<p><strong>æ ˆå¸§å†…å®¹åŒ…å«:å±€éƒ¨å˜é‡è¡¨,æ“ä½œæ•°æ ˆ,åŠ¨æ€é“¾æ¥,æ–¹æ³•è¿”å›åœ°å€,é™„åŠ ä¿¡æ¯ç­‰.</strong></p>
<p>æ ˆå†…å­˜é»˜è®¤æœ€å¤§æ˜¯<strong>1M</strong>.è¶…å‡ºåˆ™æŠ›å‡ºStackOverFlowError</p>
<h4 id="æœ¬åœ°æ–¹æ³•æ ˆ">æœ¬åœ°æ–¹æ³•æ ˆ</h4>
<p>å’Œè™šæ‹Ÿæœºæ ˆåŠŸèƒ½ç±»ä¼¼,ä¸åŒçš„æ˜¯è™šæ‹Ÿæœºæ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºæ‰§è¡Œjavaæ–¹æ³•è€Œå‡†å¤‡çš„,æœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºä½¿ç”¨Nativeæœ¬åœ°æ–¹æ³•è€Œå‡†å¤‡çš„.</p>
<p>è™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰è§„å®šå…·ä½“çš„å®ç°,ç”±ä¸åŒçš„è™šæ‹Ÿæœºå‚å•†å»å®ç°.</p>
<p>HotSpotè™šæ‹Ÿæœºä¸­çš„è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆçš„å®ç°æ˜¯ä¸€æ ·çš„.åŒæ ·,è¶…å‡ºå¤§å°ä»¥åä¹Ÿä¼šæŠ›å‡ºStackOverFlowError</p>
<h4 id="ç¨‹åºè®¡æ•°å™¨program-counter-register">ç¨‹åºè®¡æ•°å™¨(Program Counter Register)</h4>
<p>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œå­—èŠ‚ç çš„ä½ç½®,å­˜å‚¨çš„æ˜¯å­—èŠ‚ç æŒ‡ä»¤åœ°å€.</p>
<p>å¦‚æœæ‰§è¡ŒNativeæ–¹æ³•,åˆ™è®¡æ•°å™¨å€¼ä¸ºç©º.</p>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç©ºé—´æœ‰ä¸€ä¸ªç§æœ‰çš„ç©ºé—´,å ç”¨å†…å­˜ç©ºé—´å¾ˆå°‘.</p>
<p>CPUåŒä¸€æ—¶é—´åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤.JVMå¤šçº¿ç¨‹ä¼šè½®æµåˆ‡æ¢å¹¶åˆ†é…CPUæ‰§è¡Œæ—¶é—´.åœ¨çº¿ç¨‹åˆ‡æ¢å,éœ€è¦é€šè¿‡ç¨‹åºè®¡æ•°å™¨æ¥æ¢å¤æ­£ç¡®çš„æ‰§è¡Œä½ç½®.</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[activemqå¯åŠ¨æŠ¥é”™Failed to connect to the Wrapper at port 32000]]></title>
        <id>https://www.sunjianbo.com/activemq-wrapper-error/</id>
        <link href="https://www.sunjianbo.com/activemq-wrapper-error/">
        </link>
        <updated>2020-05-06T08:36:28.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ">ç¯å¢ƒ</h2>
<blockquote>
<p>win7 x64</p>
<p>java1.8.0_20</p>
<p>activemq:5.15.12(å½“å‰æœ€æ–°)</p>
</blockquote>
<h2 id="æŠ¥é”™ä¿¡æ¯">æŠ¥é”™ä¿¡æ¯</h2>
<p>è¿è¡Œ<code>apache-activemq\bin\win64\activemq.bat</code>æŠ¥å¦‚ä¸‹é”™è¯¯:</p>
<pre><code>jvm 1    | Failed to connect to the Wrapper at port 32000.
jvm 1    | java.net.ConnectException: connect: Address is invalid on local machine, or port is not valid on remote machine
jvm 1    | Exiting JVM...
</code></pre>
<p>ç¼–è¾‘<code>win64</code>ç›®å½•ä¸‹<code>wrapper.conf</code>æ–‡ä»¶,å–æ¶ˆæ³¨é‡Š</p>
<pre><code># wrapper.debug=TRUE
</code></pre>
<hr>
<p>title: 'activemqå¯åŠ¨æŠ¥é”™Failed to connect to the Wrapper at port 32000'<br>
date: 2020-05-06 16:36:28<br>
tags: [activemq,wrapper,æŠ¥é”™]<br>
published: true<br>
hideInList: false<br>
feature:<br>
isTop: false</p>
<hr>
<pre><code>INFO   | jvm 1    | 2020/05/06 16:26:52 | Load native library.  One or more attempts may fail if platform specific libraries do not exist.
INFO   | jvm 1    | 2020/05/06 16:26:52 | Loading native library failed: wrapper-windows-x86-64.dll  Cause: java.lang.UnsatisfiedLinkError: no wrapper-windows-x86-64 in java.library.path
</code></pre>
<h2 id="è¯•å›¾è§£å†³">è¯•å›¾è§£å†³</h2>
<p>æ ¹æ®ä»¥ä¸Šä¸¤ä¸ªå…³é”®ä¿¡æ¯è¿›è¡ŒGoogle,ç„¶è€Œå´©æºƒçš„æ˜¯è‚¡æ²Ÿäº†å¥½ä¹…æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ³•</p>
<p>æœŸé—´å°è¯•äº†ç½‘ä¸Šè¯´çš„ä¿®æ”¹<code>conf/activemq.xml</code>ä¸<code>conf/jetty.xml</code>é…ç½®æ–‡ä»¶ä¸­çš„ip<code>0.0.0.0</code>æ”¹ä¸º<code>127.0.0.1</code></p>
<p>ä¿®æ”¹<code>wrapper.conf</code>æ–‡ä»¶ä¸­çš„<code>wrapper.java.command=java</code>ä¸ºæŒ‡å®š<code>jdkpath\bin\java</code></p>
<p>å‡æ— æ•ˆ,æœ€åæ”¾å¼ƒè¿™ç§å¯åŠ¨æ–¹å¼,æ”¹ä¸ºä¸‹é¢æ–¹å¼å¯åŠ¨.æ²¡æœ‰æŠ¥é”™</p>
<h2 id="æœ€ç»ˆè§£å†³æ–¹æ¡ˆ">æœ€ç»ˆè§£å†³æ–¹æ¡ˆ</h2>
<p>åŒå‡»è¿è¡Œ<code>apache-activemq\bin\win6\InstallService.bat</code>ä»¥å®‰è£…æœåŠ¡</p>
<p><code>win+r</code>å¯åŠ¨<code>cmd</code>è¾“å…¥:</p>
<pre><code>net start activemq
</code></pre>
<p>å®Œå…¨æ²¡æŠ¥é”™,é¡ºåˆ©å¯åŠ¨</p>
<p>æµè§ˆå™¨æ‰“å¼€<a href="http://127.0.0.1:8161">http://127.0.0.1:8161</a></p>
<p>æˆåŠŸè®¿é—®</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[hp chromebook 11 G1é€šè¿‡croutonå®‰è£…åŠä½¿ç”¨Debian]]></title>
        <id>https://www.sunjianbo.com/chromebook-crouton-linux/</id>
        <link href="https://www.sunjianbo.com/chromebook-crouton-linux/">
        </link>
        <updated>2020-04-24T06:31:03.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ä¸€å…³äºå¤‡ä»½">ä¸€.å…³äºå¤‡ä»½</h2>
<p>åœ¨æ“ä½œä¹‹å‰æœ¬æ¥åº”è¯¥æ˜¯å¤‡ä»½çš„,ä½†æ˜¯è€ƒè™‘åˆ°å®˜æ–¹æä¾›æ•‘ç –çš„æ–¹æ³•(<a href="https://support.google.com/chromebook/answer/1080595?hl=zh-Hans">https://support.google.com/chromebook/answer/1080595?hl=zh-Hans</a>),ä¹Ÿå°±å…ˆæ”¾å¿ƒçš„ç›´æ¥ä¸Šæ‰‹å®‰è£…äº†.(ä¸»è¦åŸå› å…¶å®æ˜¯æ²¡æœ‰uç›˜(â—”â—¡â—”))</p>
<h2 id="äºŒè¿›å…¥å¼€å‘è€…æ¨¡å¼">äºŒ.è¿›å…¥å¼€å‘è€…æ¨¡å¼</h2>
<p>åŒæ—¶æŒ‰ä½<code>esc + refresh + power</code></p>
<p>ç„¶åè‡ªåŠ¨é‡å¯,æç¤ºä½ ç³»ç»Ÿå·²ç»æŸå,å¥½äº†ç»“æŸäº†,å¯ä»¥å–ç ´çƒ‚äº†(â—”â—¡â—”)</p>
<p>å½“ç„¶ä¸ä¼šè¿™æ ·,å†æŒ‰ä¸€ä¸‹<code>ctrl+D</code>æç¤ºå…³é—­ç³»ç»ŸéªŒè¯,å†æŒ‰Enter,æç¤ºéªŒè¯å·²å…³é—­,ç»§ç»­<code>ctrl+D</code>*2</p>
<p>æœ€åç³»ç»Ÿå¼€å§‹ä¸ºäº†è¿›å…¥å¼€å‘è€…æ¨¡å¼å‡†å¤‡ä¸€äº›ä¸œè¥¿,éœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿ.</p>
<p>å‡†å¤‡å®Œæˆé‡å¯ä¹‹å,å°±å§‹ç»ˆéœ€è¦æŒ‰<code>ctrl+D</code>æ¥è¿›å…¥chromeOSäº†</p>
<h2 id="ä¸‰ä¸‹è½½crouton">ä¸‰.ä¸‹è½½crouton</h2>
<p>croutoné¡¹ç›®çš„github:<a href="https://github.com/dnschneid/crouton">https://github.com/dnschneid/crouton</a></p>
<p>åœ¨Usageå†…å®¹ä¸‹æœ‰ä¸ªä¸‹è½½åœ°å€,è¿™é‡Œç›´æ¥è´´å‡ºæ¥äº†:<a href="https://goo.gl/fd3zc">https://goo.gl/fd3zc</a></p>
<p>ä¸‹è½½ä¸‹æ¥åº”è¯¥é»˜è®¤å­˜å‚¨åœ¨</p>
<h2 id="å››æ‰“å¼€shell">å››.æ‰“å¼€shell</h2>
<p><code>ctrl+alt+t</code>æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œ,è¿™æ˜¯chromeçš„crosh,å†è¾“å…¥<code>shell</code>å›è½¦è¿›å…¥linux shell</p>
<h2 id="äº”å®‰è£…linux">äº”.å®‰è£…linux</h2>
<p>å› ä¸ºé…ç½®åƒåœ¾,æ‰€ä»¥é€‰æ‹©äº†debian buster+lxdeæ¡Œé¢,åœ¨è¿™ä¹‹å‰æˆ‘æŸ¥çœ‹äº†ä¸€ä¸‹å‰©ä½™ç©ºé—´<strong>9.2G</strong></p>
<pre><code class="language-shell">sudo sh crouton -r buster -t lxde -P http://127.0.0.1:7890
</code></pre>
<p><code>-P</code> å‚æ•°æ˜¯ç”¨æ¥æŒ‡å®šç¿»å¢™ä»£ç†çš„,ä¸‹é¢å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å¯å®‰è£…çš„linux</p>
<pre><code class="language-shell">sudo sh crouton -t list -P http://127.0.0.1:7890
</code></pre>
<h3 id="ä¸­é—´å› ä¸ºç½‘ç»œé—®é¢˜å¤±è´¥äº†ä¸€æ¬¡å†æ¬¡å®‰è£…ä¼šæŠ¥é”™">ä¸­é—´å› ä¸ºç½‘ç»œé—®é¢˜å¤±è´¥äº†ä¸€æ¬¡,å†æ¬¡å®‰è£…ä¼šæŠ¥é”™:</h3>
<blockquote>
<p>/usr/local/chroots/buster already has stuff in it!<br>
Either delete it, specify a different name (-n), or specify -u to update it.</p>
</blockquote>
<p>æ ¹æ®æç¤ºä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰èƒ½ç»§ç»­</p>
<pre><code>sudo sh crouton -u -n buster -t lxde -P http://127.0.0.1:7890
</code></pre>
<h3 id="å®‰è£…è€—æ—¶1410-1701æ¥è¿‘ä¸‰å°æ—¶å…¬å¸åƒåœ¾ç½‘ä¸‹è½½é€Ÿåº¦ä¸åˆ°100ä¸‹è½½æ–‡ä»¶500må·¦å³å®‰è£…å®Œæˆåç¬¬ä¸€æ¬¡å¯åŠ¨åå‰©ä½™ç©ºé—´76gå³å ç”¨16g">å®‰è£…è€—æ—¶14.10-17.01æ¥è¿‘ä¸‰å°æ—¶,å…¬å¸åƒåœ¾ç½‘ä¸‹è½½é€Ÿåº¦ä¸åˆ°100,ä¸‹è½½æ–‡ä»¶500Må·¦å³,å®‰è£…å®Œæˆåç¬¬ä¸€æ¬¡å¯åŠ¨åå‰©ä½™ç©ºé—´7.6G,å³å ç”¨1.6G</h3>
<h3 id="å¯åŠ¨linux">å¯åŠ¨linux</h3>
<pre><code>sudo startlxde
</code></pre>
<h2 id="å…­å¤‡ä»½å›å¤åˆ é™¤ç³»">å…­.å¤‡ä»½/å›å¤/åˆ é™¤ç³»</h2>
<p>å¤‡ä»½å‘½ä»¤:</p>
<pre><code>sudo edit-chroot -b buster -f ~/Downloads/buster-backup.bak
</code></pre>
<p>æ¢å¤:</p>
<pre><code>sudo sh -e ~/Downloads/crouton -f ~/Downloads/buster-backup.bak
</code></pre>
<p>åˆ é™¤</p>
<pre><code>sudo delete-chroot buster
</code></pre>
<p>æˆ–è€…</p>
<pre><code>sudo edit-chroot -d buster
</code></pre>
<h2 id="ä¸ƒä½¿ç”¨">ä¸ƒ.ä½¿ç”¨:</h2>
<h3 id="1ä¸å¯åŠ¨æ•´ä¸ªlinuxåªå¯åŠ¨å…¶shell">1.ä¸å¯åŠ¨æ•´ä¸ªlinuxåªå¯åŠ¨å…¶shell:</h3>
<pre><code>sudo enter-chroot
</code></pre>
<h3 id="2ç³»ç»Ÿä»»æ„åˆ‡æ¢">2.ç³»ç»Ÿä»»æ„åˆ‡æ¢</h3>
<blockquote>
<p>shift+ctrl+alt+å‰è¿›é”®(F2)/åé€€é”®(F1)</p>
</blockquote>
<p>ä¸æ˜¯è¯´åé€€åˆ‡æ¢è¿‡å»ç„¶åå‰è¿›åˆ‡æ¢å›æ¥,è€Œæ˜¯åªè¦ç”¨ä¸€ä¸ªç»„åˆé”®å°±å¯ä»¥æ¥å›åˆ‡æ¢,æŒ‰ä¸€ä¸‹åˆ‡æ¢å†æŒ‰ä¸€ä¸‹åˆ‡æ¢å›æ¥</p>
<h3 id="3å®‰è£…åç³»ç»Ÿé…ç½®">3.å®‰è£…åç³»ç»Ÿé…ç½®</h3>
<p>å‚è€ƒè¿™ç¯‡æ–‡ç« :<a href="https://frapples.github.io/articles/2017-05-11-e6dc.html">https://frapples.github.io/articles/2017-05-11-e6dc.html</a></p>
<h3 id="4å®‰è£…clash">4.å®‰è£…clash</h3>
<p>chromeçš„shadowsocksæ’ä»¶æ¯”è¾ƒè€,å¾ˆå¤šæ–°çš„åŠ å¯†åè®®éƒ½ä¸æ”¯æŒ,æ‰€ä»¥æˆ‘ä¹‹å‰éƒ½æ˜¯èµ°å±€åŸŸç½‘çš„ä»£ç†,è£…å¥½clashå°±å¯ä»¥è‡ªç»™è‡ªè¶³äº†</p>
<p>å®Œæ•´æ•™ç¨‹:<a href="https://ssu.tw/index.php/archives/37/">https://ssu.tw/index.php/archives/37/</a></p>
<pre><code>cd ~
sudo mkdir clash //åˆ›å»ºç›®å½•
cd clash //åˆ‡æ¢è‡³æ­¤ç›®å½•
sudo wget https://github.com/Dreamacro/clash/releases/download/v0.19.0/clash-linux-armv7-v0.19.0.gz //ä¸‹è½½Då¤§é¢„ç¼–è¯‘å¥½çš„åŒ…
sudo gunzip clash-linux-armv7-v0.19.0.gz //è§£å‹ï¼Œè®°å¾—å¯ä»¥ä½¿ç”¨Tabé”®è¡¥å…¨ï¼Œå¾—åˆ°clashçš„äºŒè¿›åˆ¶
sudo mv clash-linux-armv7-v0.19.0 /usr/local/bin/clash //ç§»åŠ¨å¹¶é‡å‘½åï¼Œç®€çŸ­æ–¹ä¾¿ä½¿ç”¨
sudo chmod +x /usr/local/bin/clash //èµ‹äºˆæ­¤æ–‡ä»¶å¯æ‰§è¡Œæƒé™
</code></pre>
<p>ä¸‹è½½é…ç½®æ–‡ä»¶æ ·ä¾‹</p>
<pre><code>sudo wget https://raw.githubusercontent.com/ConnersHua/Profiles/master/Clash/Pro.yaml //ä¸‹è½½èŒƒä¾‹é…ç½®æ–‡ä»¶
sudo mv Pro.yaml config.yaml //é‡å‘½å
</code></pre>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<pre><code>sudo vim config.yaml //ç¼–è¾‘æ­¤é…ç½®æ–‡ä»¶

# è¿™é‡Œå»ºè®®ä»falseæ”¹ä¸ºtrueï¼Œå…è®¸å±€åŸŸç½‘å…±äº«
allow-lan: true

# ä¸‹é¢è¿™è¡Œï¼Œå»ºè®®å–æ¶ˆå‰é¢#æ³¨é‡Šç¬¦å·
bind-address: &quot;*&quot;

# RESTful API for clash
# ä¿®æ”¹å¤–éƒ¨æ§åˆ¶ï¼Œå°†127.0.0.1æ”¹ä¸º0.0.0.0
external-controller: 0.0.0.0:9090
</code></pre>
<p>å¯åŠ¨clash</p>
<pre><code>clash -d ~/clash
</code></pre>
<p>clashå¯åŠ¨ä¹‹åï¼Œä½ å¯ä»¥ç”¨å±€åŸŸç½‘çš„è®¾å¤‡è®¿é—®<code>http://clash.razord.top</code>ï¼Œ ç„¶åHostå¡«å†™ä½ æ ‘è“æ´¾åœ¨å±€åŸŸç½‘ä¸­çš„IPåœ°å€ï¼Œç«¯å£å¡«å†™ä¸Šé¢è®¾ç½®çš„9090ï¼Œå³å¯è®¿é—®æˆåŠŸã€‚</p>
<h3 id="5å®‰è£…typoraå¤±è´¥">5.å®‰è£…Typora(å¤±è´¥)</h3>
<p>å› ä¸ºæœ¬æ¥æä¸ªchromebookå®šä½å°±æ˜¯ç”¨æ¥å†™æ–‡æ¡£çš„,æ‰€ä»¥å®‰è£…è‡ªå·±ç”¨ä¹ æƒ¯çš„mdç¼–è¾‘å™¨Typora,æ–¹æ³•å‚è€ƒ<a href="https://support.typora.io/Typora-on-Linux/">å®˜æ–¹æ–‡æ¡£</a></p>
<pre><code class="language-shell">wget -qO - https://typora.io/linux/public-key.asc | sudo apt-key add -
sudo add-apt-repository 'deb https://typora.io/linux ./'
# è‹¥æŠ¥é”™ add-apt-repository: command not foundåˆ™å…ˆæ‰§è¡Œ:sudo apt-get install software-properties-common
sudo apt-get update
sudo apt-get install typora
</code></pre>
]]></content>
    </entry>
</feed>